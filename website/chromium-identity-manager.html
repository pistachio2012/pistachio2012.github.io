<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Chromium浏览器的定制与优化，及二次开发">
  <meta name="keywords" content="Chromium 浏览器 定制 优化 二次开发">
  <meta name="author" content="pistachio2012@126.com">
  <meta name="robots" content="index, follow">
  <title>Chromium定制及二次开发</title>
</head>
<body>
<h1>Chromium定制及二次开发:修改账号系统</h1>
<p>本文主要是关于Gaia(Google Accounts and ID Administration ID)在Chromium中的管理与使用，其中IdentityManager类即是核心也是中心。</p>
<h2 id="-">几个核心概念</h2>
<p>这些概念可以从整体上了解一下ID管理相关的类和方法。</p>
<h3 id="accounts">Accounts</h3>
<p>Chromium中账户总是指的Gaia账户，一个账户主要有三个核心信息，其包含在Struct CoreAccountInfo中，
并且只要在IdentityManager中，那么就是有效的。</p>
<ul>
<li>email地址</li>
<li>Gaia ID</li>
<li>CoreAccountId 这是Chromium内部用的ID，一般和Gaia ID是一样的</li>
</ul>
<p>在账户添加到Chromium后还会异步地获取一些扩展信息，这些信息包含在CoreAccountInfo的子类Struct AccountInfo中，
包括全名、地域、图标等信息。IdentityManager和其观察者中名字带ExtendedAccountInfo的方法都与这些信息的修改相关。</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> CoreAccountInfo {
  ...
  CoreAccountId account_id;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> gaia;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> email;
  ...
}

<span class="hljs-keyword">struct</span> AccountInfo : <span class="hljs-keyword">public</span> CoreAccountInfo {
  ...
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> full_name;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> given_name;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> hosted_domain;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> locale;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> picture_url;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> last_downloaded_image_url_with_size;
  gfx::Image account_image;
  ...
}
</code></pre>
<h3 id="the-primary-account">The Primary Account</h3>
<p>主账户就是Chromium与Google云进行同步的账户，之前称为已认证账户。
UPA(Unconsented primary account)是指可能授权的主账户，主要用于展示给用户。
在主账户存在时，UPA就是主账户。在主账户不存在却登陆了多个账户，UPA就是第一个有Refresh Token的登陆账户，
并且Cookie和Token必须是最新的，其主要计算逻辑在SigninManager:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> SigninManager : <span class="hljs-keyword">public</span> KeyedService,
                      <span class="hljs-keyword">public</span> signin::IdentityManager::Observer {
  ...
  <span class="hljs-function">CoreAccountInfo <span class="hljs-title">ComputeUnconsentedPrimaryAccountInfo</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
  ...
}
</code></pre>
<p>IdentityManager和其观察者中名字带PrimaryAccount的方法都与主账户的修改相关。</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> IdentityManager : <span class="hljs-keyword">public</span> KeyedService ... {
  ...
  <span class="hljs-function">CoreAccountInfo <span class="hljs-title">GetPrimaryAccountInfo</span><span class="hljs-params">(ConsentLevel consent_level)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function">CoreAccountId <span class="hljs-title">GetPrimaryAccountId</span><span class="hljs-params">(ConsentLevel consent_level)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">HasPrimaryAccount</span><span class="hljs-params">(ConsentLevel consent_level)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">HasPrimaryAccountWithRefreshToken</span><span class="hljs-params">(ConsentLevel consent_level)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function">PrimaryAccountMutator* <span class="hljs-title">GetPrimaryAccountMutator</span><span class="hljs-params">()</span></span>;
  ...
}
</code></pre>
<h3 id="oauth2-access-and-refresh-tokens">OAuth2 Access and Refresh Tokens</h3>
<p>OAuth2是一个认证协议，其有两个Token，分别是短期的Access Token和长期的Refresh Token。
Refresh Token由IdentityManager中的ProfileOAuth2TokenService存储，并且提供Access Token给其他对象使用。
有Refresh Token的账户可以是用户登陆的，也可以是系统登陆的。
IdentityManager和其观察者中名字带RefreshToken的方法都与Refresh Token的修改相关。</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> IdentityManager : <span class="hljs-keyword">public</span> KeyedService ... {
  ...
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;AccessTokenFetcher&gt; CreateAccessTokenFetcherForAccount(...);
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;AccessTokenFetcher&gt; CreateAccessTokenFetcherForClient(...);
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RemoveAccessTokenFromCache</span><span class="hljs-params">(...)</span></span>;

  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;CoreAccountInfo&gt; GetAccountsWithRefreshTokens() <span class="hljs-keyword">const</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;AccountInfo&gt; GetExtendedAccountInfoForAccountsWithRefreshToken() <span class="hljs-keyword">const</span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">HasPrimaryAccountWithRefreshToken</span><span class="hljs-params">(ConsentLevel consent_level)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">HasAccountWithRefreshToken</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">AreRefreshTokensLoaded</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">HasAccountWithRefreshTokenInPersistentErrorState</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function">GoogleServiceAuthError <span class="hljs-title">GetErrorStateOfRefreshTokenForAccount</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> <span class="hljs-keyword">const</span></span>;
  ...
}
</code></pre>
<h3 id="the-gaia-cookie">The Gaia Cookie</h3>
<p>这是包含一些账户信息的Cookie，并且能被网页使用。这些账户和OAuth2认证的账户是不一样的，而且在信息的打包上有明显的区别。
IdentityManager和其观察者中有些方法是与其相关的：</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> IdentityManager : <span class="hljs-keyword">public</span> KeyedService ... {
  ...
  <span class="hljs-function">AccountsInCookieJarInfo <span class="hljs-title">GetAccountsInCookieJar</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
  <span class="hljs-function">AccountsCookieMutator* <span class="hljs-title">GetAccountsCookieMutator</span><span class="hljs-params">()</span></span>;
  ...
}
</code></pre>
<h3 id="mutation-of-account-state">Mutation of Account State</h3>
<p>在IdentityManager中有多个账户修改者对象，如PrimaryAccountMutator，其主要用于修改账户状态，并且账户状态的修改过程是可定制的。
chromium用PrimaryAccountMutator修改主账户，但是在ChromeOS上没有主账户退出。
AccountsCookieMutator用于更新在Cookie中的账户。
在不同的平台上对OAuth2的账户修改是不同的：</p>
<ul>
<li>Windows/Mac/Linux：Chromium内部管理其Refresh Token，并且通过AccountsMutator添加和删除</li>
<li>ChromeOS：Chromium通过同步系统的AccoutManager来获取Refresh Token</li>
<li>Android：Chromium通过Identityutator来获取Refresh Token</li>
<li>iOS：Chromium通过DeviceAccountsSynchronizer来获取google的iOS SSO库的支持</li>
</ul>
<p>在中有个Mutator的统一类接口：</p>
<pre><code class="lang-cpp">class IdentityMutator {
  ...
  <span class="hljs-symbol">std:</span><span class="hljs-symbol">:unique_ptr&lt;PrimaryAccountMutator&gt;</span> primary_account_mutator<span class="hljs-number">_</span>;
  <span class="hljs-symbol">std:</span><span class="hljs-symbol">:unique_ptr&lt;AccountsMutator&gt;</span> accounts_mutator<span class="hljs-number">_</span>;
  <span class="hljs-symbol">std:</span><span class="hljs-symbol">:unique_ptr&lt;AccountsCookieMutator&gt;</span> accounts_cookie_mutator<span class="hljs-number">_</span>;
  <span class="hljs-symbol">std:</span><span class="hljs-symbol">:unique_ptr&lt;DeviceAccountsSynchronizer&gt;</span> device_accounts_synchronizer<span class="hljs-number">_</span>; <span class="hljs-regexp">//</span>这个一般用iOS上
  ...
}
</code></pre>
<h2 id="id-identitymanager">ID核心服务——IdentityManager</h2>
<p>IdentityManager是KeyedService子类，在Chromium中以服务形式存在，在//chrome中可以通过IdentityManagerFactory::GetForProfile()获取，
因为每一个Profile都有一个对应的IdentityManager，并且在Profile创建时被建立的。在初始化时IdentityManager会从WebData中获取已登陆的用户。</p>
<h3 id="-">监听账户的变化</h3>
<p>IdentityManager使用经典的观察者设计模式来传播账户的变化，观察者接口为：</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> IdentityManager::Observer {
  <span class="hljs-comment">//主账户发生了变化</span>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPrimaryAccountChanged</span><span class="hljs-params">(<span class="hljs-keyword">const</span> PrimaryAccountChangeEvent&amp; event_details)</span> </span>{}
  <span class="hljs-comment">//OAuth2账户相关的变化</span>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRefreshTokenUpdatedForAccount</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountInfo&amp; account_info)</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRefreshTokenRemovedForAccount</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnErrorStateOfRefreshTokenUpdatedForAccount</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountInfo&amp; account_info, <span class="hljs-keyword">const</span> GoogleServiceAuthError&amp; error)</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnRefreshTokensLoaded</span><span class="hljs-params">()</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnEndBatchOfRefreshTokenStateChanges</span><span class="hljs-params">()</span> </span>{}
  <span class="hljs-comment">//在Cookie中的账户发生了变化</span>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnAccountsInCookieUpdated</span><span class="hljs-params">(<span class="hljs-keyword">const</span> AccountsInCookieJarInfo&amp; accounts_in_cookie_jar_info, <span class="hljs-keyword">const</span> GoogleServiceAuthError&amp; error)</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnAccountsCookieDeletedByUserAction</span><span class="hljs-params">()</span> </span>{}
  <span class="hljs-comment">//账户的扩展信息发生了变化</span>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnExtendedAccountInfoUpdated</span><span class="hljs-params">(<span class="hljs-keyword">const</span> AccountInfo&amp; info)</span> </span>{}
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnExtendedAccountInfoRemoved</span><span class="hljs-params">(<span class="hljs-keyword">const</span> AccountInfo&amp; info)</span> </span>{}
  <span class="hljs-comment">//服务关闭</span>
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnIdentityManagerShutdown</span><span class="hljs-params">(IdentityManager* identity_manager)</span> </span>{}
}
</code></pre>
<p>注册了IdentityManager的观察者主要是：</p>
<ul>
<li>FamilyLinkUserMetricsProvider用户上报</li>
<li>AccountInvestigator用于监视Cookie账户并做Report，也是一个KeyedService</li>
<li>GAIAInfoUpdateService用于修改Profile中的内容，也是一个KeyedService</li>
<li>AdvancedProtectionStatusManager用于保护主账户，也是一个KeyedService</li>
<li>SigninProfileAttributesUpdater用于改变登陆后属性，也是一个KeyedService</li>
<li>SigninManager用于找到UPA，也是一个KeyedService</li>
<li>PersonalDataManager用于数据填充，也是一个KeyedService</li>
<li>IdentityAPI用于传播登陆状态</li>
<li>RendererUpdater用于更新Renderer的配置，也是一个KeyedService</li>
<li>GCMProfileService用于更新GCM(Google Cloud Messaging)状态，也是一个KeyedService</li>
<li>TrustedVaultAccessTokenFetcherFrontend用于在UI线程中获取Access Token</li>
<li>StandaloneTrustedVaultBackend保存Keys</li>
<li>SigninErrorController用于跟踪验证状态，也是一个KeyedService</li>
<li>AccountReconcilor用于协调Cookie和OAuth2账户一致</li>
<li>AboutSigninInternals为chrome://signin-internals/提供数据</li>
<li>SyncServiceImpl</li>
<li>PasswordModelTypeController</li>
<li>SyncAuthManager跟踪用于同步的账户</li>
<li>UnifiedConsentService</li>
<li>UserPolicySigninService</li>
<li>SyncSessionDurationsMetricsRecorder</li>
<li>ProfileIdentityProvider</li>
<li>AvatarToolbarButtonDelegate</li>
<li>OneGoogleBarService::SigninObserver</li>
<li>PasswordStoreSigninNotifierImpl</li>
<li>LogoServiceImpl</li>
</ul>
<h3 id="-">拥有的服务</h3>
<p>IdentityManager是核心也是中心，其通过调用其他服务来实现对账户的管理，其拥有的主要服务有：</p>
<ul>
<li>AccountTrackerService检索或缓存Gaia账户信息</li>
<li>ProfileOAuth2TokenService存储Refresh Token，并且管理这Access Token</li>
<li>GaiaCookieManagerService管理在Cookie jar中的Gaia账户</li>
<li>AccountFetcherService管理着获取用户信息的请求</li>
</ul>
<h3 id="-refresh-token">存储Refresh Token</h3>
<p>ProfileOAuth2TokenService在创建时会传入ProfileOAuth2TokenServiceDelegate，其大部分的业务实现都会调用这个Delegate，
而且在开启DICE的情况下，Dategate是其子类MutableProfileOAuth2TokenServiceDelegate:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> MutableProfileOAuth2TokenServiceDelegate : <span class="hljs-keyword">public</span> ProfileOAuth2TokenServiceDelegate ... {
  ...
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LoadCredentials</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; primary_account_id)</span> override</span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">UpdateCredentials</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; refresh_token)</span> override</span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RevokeAllCredentials</span><span class="hljs-params">()</span> override</span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RevokeCredentials</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> override</span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ExtractCredentials</span><span class="hljs-params">(ProfileOAuth2TokenService* to_service, <span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> override</span>;

  <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">RefreshTokenIsAvailable</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> <span class="hljs-keyword">const</span> override</span>;
  <span class="hljs-built_in">std</span>::<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">GetRefreshToken</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id)</span> <span class="hljs-keyword">const</span></span>;
  ...
}
</code></pre>
<h3 id="-access-token-">使用Access Token发送请求</h3>
<p>ProfileOAuth2TokenService通过调用OAuth2AccessTokenManager实现Access Token的管理，
OAuth2AccessTokenManager会在缓存的Access Token中找到账户对应的Access Token，如果没找到会用存储的Refresh Token发起获取请求，
在更新Access Token后会调用OAuth2AccessTokenManager::Consumer中的回调，
这些逻辑大部分在OAuth2AccessTokenManager中实现，其接口为：</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> OAuth2AccessTokenManager {
  ...
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Request&gt; StartRequest(<span class="hljs-keyword">const</span> CoreAccountId&amp; account_id, <span class="hljs-keyword">const</span> ScopeSet&amp; scopes, Consumer* consumer);
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Request&gt; StartRequestForClient( <span class="hljs-keyword">const</span> CoreAccountId&amp; account_id, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; client_id, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; client_secret, <span class="hljs-keyword">const</span> ScopeSet&amp; scopes, Consumer* consumer);
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;Request&gt; StartRequestWithContext( <span class="hljs-keyword">const</span> CoreAccountId&amp; account_id, scoped_refptr&lt;network::SharedURLLoaderFactory&gt; url_loader_factory, <span class="hljs-keyword">const</span> ScopeSet&amp; scopes, Consumer* consumer);
  ...
}
</code></pre>
<h2 id="-google-_api-gaia-">//google_api/gaia目录中的源码</h2>
<p>这个目录下是Gaia与google服务器联系相关的代码，如果要修改为定制的ID，那么大部分应该是修改这里的代码，
比如gaia_url中是google服务器的地址，gaia_auth_fetcher发送Gaia相关的请求并解码后给GaiaAuthConsumer的子类进一步处理，
而且Gaia Access Token相关的调用也在这里，OAuth2AccessTokenManager的源码文件oauth2_access_token_manager.h/.cc。</p>
<h3 id="-google-accounts-apis-">使用Google Accounts APIs鉴权</h3>
<p>GaiaAuthFetcher类封装了对Google Accounts APIs的调用了</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> GaiaAuthFetcher {
  ...
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartRevokeOAuth2Token</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; auth_token)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartAuthCodeForOAuth2TokenExchange</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; auth_code)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartAuthCodeForOAuth2TokenExchangeWithDeviceId</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; auth_code, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; device_id)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartGetUserInfo</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; lsid)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartMergeSession</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; uber_token, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; external_cc_result)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartTokenFetchForUberAuthExchange</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; access_token)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartOAuthLogin</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; access_token, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; service)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartOAuthMultilogin</span><span class="hljs-params">(gaia::MultiloginMode mode, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;MultiloginTokenIDPair&gt;&amp; accounts, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; external_cc_result)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartListAccounts</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">StartLogOut</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">StartCreateReAuthProofTokenForParent</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; child_oauth_access_token, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; parent_obfuscated_gaia_id, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; parent_credential)</span></span>;
  ...
}
</code></pre>
<p>在GaiaAuthFetcher中有一系列Google Accounts APIs的url常量作为网络访问地址，其值都是从GaiaUrls类中获取的常量值。
在Start*接口实现中，首先通过Make*接口创建要GET/POST的参数，然后用对应的网络地址常量，
调用private接口创建网络访问请求：</p>
<pre><code class="lang-cpp">  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateAndStartGaiaFetcher</span><span class="hljs-params">(
      <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; body,
      <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; body_content_type,
      <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; headers,
      <span class="hljs-keyword">const</span> GURL&amp; gaia_gurl,
      network::mojom::CredentialsMode credentials_mode,
      <span class="hljs-keyword">const</span> net::NetworkTrafficAnnotationTag&amp; traffic_annotation)</span></span>;
</code></pre>
<p>CreateAndStartGaiaFetcher实现中，首先创建ResourceRequest，然后将Gaia的Cookie添加到ResourceRequest,
然后为ResourceRequest创建对应的SimpleURLLoader进行网络访问，网络返回会异步地传个private方法OnURLLoadComplete，</p>
<pre><code class="lang-cpp">  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnURLLoadComplete</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; response_body)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnURLLoadCompleteInternal</span><span class="hljs-params">(net::Error net_error, <span class="hljs-keyword">int</span> response_code, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> response_body)</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">DispatchFetchedRequest</span><span class="hljs-params">(<span class="hljs-keyword">const</span> GURL&amp; url, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; data, net::Error net_error, <span class="hljs-keyword">int</span> response_code)</span></span>;
</code></pre>
<p>OnURLLoadComplete解析出response_code和data后，会调用OnURLLoadCompleteInternal找到original_url，
然后调用DispatchFetchedRequest函数，通过original_url来分发网络返回到对应的处理函数，
对应的函数会在解析data中的数据后，调用GaiaAuthConsumer对应的回调进行下一步的业务逻辑。</p>
<h3 id="authcode-oauth2token-">AuthCode换取OAuth2Token网络数据</h3>
<p>静态函数GaiaAuthFetcher::MakeGetTokenPairBody实现了请求body打包，参数是auth_code,device_id,
函数中通过kOAuth2CodeToTokenPairBodyFormat:&quot;scope=%s\&amp;grant_type=authorization_code\&amp;client_id=%s\&amp;client_secret=%s\&amp;code=%s&quot;进行打包，
其中scope值为<a href="https://www.google.com/accounts/OAuthLogin，">https://www.google.com/accounts/OAuthLogin，</a>
client_id值为google api keys中主ClientID，client_secret值为google api keys中主ClientSecret,
code值是参数auth_code，
如果参数device_id不为空，那么在format后添加kOAuth2CodeToTokenPairDeviceIdParam:&quot;device_id=%s\&amp;device_type=chrome&quot;
OnOAuth2TokenPairFetched是网络返回回调，在其中调用ExtractOAuth2TokenPairResponse函数来解析返回的data，
返回的数据是以JSON方式打包，其中需要解析的键值有：refresh_token，access_token，expires_in，id_token。
在获取的id_token后，从中解码出kChildAccountServiceFlag和kAdvancedProtectionAccountServiceFlag，
这样就能创建结果ClientOAuthResult。</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> GaiaAuthConsumer::ClientOAuthResult {
  ...
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> refresh_token;
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> access_token;
  <span class="hljs-keyword">int</span> expires_in_secs;
  <span class="hljs-keyword">bool</span> is_child_account;
  <span class="hljs-keyword">bool</span> is_under_advanced_protection;
  ...
}
</code></pre>
<h2 id="google-api-keys">google api keys</h2>
<p>要访问google的服务需要google api keys，但是从69版本开始通过OAuth2登陆Chromium被限制了。
参考：<p><a href="https://www.chromium.org/developers/how-tos/api-keys">https://www.chromium.org/developers/how-tos/api-keys</a></p></p>
<h2 id="dice">DICE</h2>
<p>在linux、mac、win、fuchsia下Dice是打开的，在android、chromeos、ios下打开的是mirror。</p>
<h2 id="-">同步登陆失败分析</h2>
<p>同步登陆需要将Cookie账户提高成OAuth2账户，进一步提高成Primary Account，通过跟踪分析，Cookie成功了但是OAuth2失败了。</p>
<h3 id="-">网络请求对比</h3>
<p>这是Chrome同步登陆时，网络的截图：</p>
<p><img src="./chrome.png" alt="Chrome网络截图"></p>
<p>这是Dingtao同步登陆时，网络的截图：</p>
<p><img src="./dingtao.png" alt="Dingtao网络截图"></p>
<p>从网络截图中可以很明显地看出，Chrome在登陆后有<p><a href="https://www.googleapis.com/oauth2/v4/token">https://www.googleapis.com/oauth2/v4/token</a></p>这个URL的访问，
这里有两个可能Dingtao网络中没有这个访问，一是Dingtao在逻辑处理时没有发出这个请求，
一是发出了这个请求，但是google服务器没有给返回，从google api key看第二种是最有可能的。</p>
<h3 id="-">同步登陆后账户的状态对比</h3>
<p>这是Chrome登陆后，账户状态截图：</p>
<p><img src="./chrome_accounts.png" alt="Chrome账户状态截图"></p>
<p>这是Dingtao登陆后，账户状态截图：</p>
<p><img src="./dingtao_accounts.png" alt="Dingtao账户状态截图"></p>
<p>从截图中可以看出Dingtao并没有获取到Refresh Token，因此同步登陆失败了。</p>
<h3 id="-google-chrome-key-">模拟google chrome的key值</h3>
<p>从抓包和log中提取出了google chrome的client_id和client_secret，这样在dingtao中模拟这两个值就能登陆成功，
但是还不能从google服务器上同步数据。</p>
<pre><code class="lang-cpp">    client_id:<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>
client_secret:OTJgUOQcT7lO7GsGZq2G4IlT
</code></pre>
<h2 id="-">同步登陆流程分析</h2>
<p>在点击profile弹出窗口中‘开启同步功能’按钮后，点击事件会分发到ProfileMenuView::OnSigninButtonClicked，
然后会调用signin_ui_util中的函数进行用户查找，然后调用SigninViewController中的函数在新的Tab中打开<a href="https://accounts.google.com/signin/chrome/sync?ssp=1">https://accounts.google.com/signin/chrome/sync?ssp=1</a>
具体流程如下：</p>
<pre><code class="lang-cpp">ProfileMenuView::OnSigninButtonClicked <span class="hljs-comment">//button事件处理函数</span>
signin_ui_util::EnableSyncFromMultiAccountPromo <span class="hljs-comment">//查找是否有已经登陆的账户</span>
signin_ui_util::SigninUiDelegateImplDice::ShowSigninUI <span class="hljs-comment">//判断是打开同步Tab还是添加账户Tab</span>
SigninViewController::ShowDiceSigninTab <span class="hljs-comment">//确定Gaia地址，并打开Tab访问</span>
</code></pre>
<p>在打开登陆页面过程前，ChromeContentBrowserClient::CreateURLLoaderThrottles会为网络访问创建signin::URLLoaderThrottle来hook三个网络处理函数：
WillStartRequest，WillRedirectRequest和WillProcessResponse，并且调用HeaderModificationDelegate来修改账户相关的http header，
在DICE下会调用DiceHeaderHelper来添加http header，其中device_id来自于Prefs，并且每次登出时会重新被创建：</p>
<pre><code class="lang-cpp">ChromeContentBrowserClient::CreateURLLoaderThrottles <span class="hljs-comment">//创建网络访问的节流器</span>
signin::URLLoaderThrottle <span class="hljs-comment">//sigin节流器用于hook网络访问以便于修改http header</span>
HeaderModificationDelegate <span class="hljs-comment">//与Profile对应，并且调用http header请求和响应的处理函数</span>
FixAccountConsistencyRequestHeader <span class="hljs-comment">//添加或移除http header</span>
AppendOrRemoveDiceRequestHeader <span class="hljs-comment">//处理Dice相关的http header</span>
DiceHeaderHelper<span class="hljs-selector-class">.ShouldBuildRequestHeader</span> <span class="hljs-comment">//判断当前url是否属于Gaia</span>
DiceHeaderHelper<span class="hljs-selector-class">.BuildRequestHeader</span> <span class="hljs-comment">//建立http header中的value</span>
DiceHeaderHelper<span class="hljs-selector-class">.AppendOrRemoveRequestHeader</span> <span class="hljs-comment">//将value添加到X-Chrome-ID-Consistency-Request</span>
<span class="hljs-comment">//header示例</span>
<span class="hljs-comment">//x-chrome-id-consistency-request: version=1,client_id=77185425430.apps.googleusercontent.com,device_id=8cec37c8-1f40-44cc-bb02-c6e304445560,signin_mode=all_accounts,signout_mode=show_confirmation</span>
</code></pre>
<p>打开网页后需要输入账户名和密码，会打开<a href="https://accounts.google.com/CheckCookie?continue=https%3A%2F%2Faccounts.google.com%2Fsignin%2Fchrome%2Fsync%2Ffinish%3Fcontinue%3Dhttps%253A%252F%252Fwww.google.com%252F%26est%3DANiM2xS0zq2HM6mpxxbN_A">https://accounts.google.com/CheckCookie?continue=https%3A%2F%2Faccounts.google.com%2Fsignin%2Fchrome%2Fsync%2Ffinish%3Fcontinue%3Dhttps%253A%252F%252Fwww.google.com%252F%26est%3DANiM2xS0zq2HM6mpxxbN_A</a>,
然后重定向到<a href="https://accounts.google.com/signin/chrome/sync/finish?continue=https%3A%2F%2Fwww.google.com%2F&amp;est=ANiM2xQ5jMO3kgTe1TBCsBDyfU2rzGqNznIcuMBFQJCX3ll3K6wkVSnj5hOyiPy66OHnwkFFjbq0Mw8iJI6VL_w，">https://accounts.google.com/signin/chrome/sync/finish?continue=https%3A%2F%2Fwww.google.com%2F&amp;est=ANiM2xQ5jMO3kgTe1TBCsBDyfU2rzGqNznIcuMBFQJCX3ll3K6wkVSnj5hOyiPy66OHnwkFFjbq0Mw8iJI6VL_w，</a>
然后重定向到<a href="https://www.google.com/，再打开chrome://sync-confirmation/">https://www.google.com/，再打开chrome://sync-confirmation/</a>
在<a href="https://accounts.google.com/signin/chrome/sync/finish返回中会有Gaia自定义http">https://accounts.google.com/signin/chrome/sync/finish返回中会有Gaia自定义http</a> header：X-Chrome-ID-Consistency-Response，
通过这个头的值就可以调用BuildDiceSigninResponseParams创建DiceResponseParams进行用户添加。</p>
<pre><code class="lang-cpp">sigin::URLLoaderThrottle::WillRedirectRequest <span class="hljs-comment">//hook到网络重定向</span>
ProcessAccountConsistencyResponseHeaders <span class="hljs-comment">//根据自定义header创建DiceResponseParams</span>
<span class="hljs-comment">//header示例</span>
<span class="hljs-comment">//x-chrome-id-consistency-response: action=SIGNIN,id=102877287560284957551,email=wzm.dingos@gmail.com,authuser=0,authorization_code=4/0AdQt8qjK5gAUFG4sdHF5X5FO3DpPC4vTwqIHQUOsbAshnw3KFVpGsewD6XpDI8UGigIvtQ</span>
<span class="hljs-comment">//X-Chrome-ID-Consistency-Response: action=ENABLE_SYNC,id=102877287560284957551,email=wzm.dingos@gmail.com,authuser=0</span>
</code></pre>
<p>创建DiceResponseParams后，会将其做为ProcessDiceHeader函数参数，并分发到UI线程，执行时会创建调用DiceResponseHandler::ProcessDiceHeader函数，
并且创建ProcessDiceHeaderDelegate做为参数之一，在DiceResponseHandler中会创建DiceTokenFetcher来换取Refresh Token，这是通过GaiaAuthFetcher::StartAuthCodeForOAuth2TokenExchange
发起访问网络的请求，请求成功换取Refresh Token后会通知signin::IdentityManager中的AccountsMutator进行账户添加或更新，
然后调用ProcessDiceHeaderDelegateImpl::EnableSync打开同步，其中会创建TurnSyncOnHelper，然后打开新的Tab或网页。</p>
<pre><code class="lang-cpp">ProcessDiceHeader <span class="hljs-comment">//处理网络返回的自定义http header value</span>
DiceResponseHandler::ProcessDiceHeader <span class="hljs-comment">//根据返回的action调用不同的处理函数</span>
DiceResponseHandler::ProcessEnableSyncHeader <span class="hljs-comment">//等待之前创建的DiceTokenFetcher返回</span>
DiceResponseHandler::DiceTokenFetcher::OnClientOAuthSuccess <span class="hljs-comment">//Refresh Token成功换取</span>
DiceResponseHandler::OnTokenExchangeSuccess <span class="hljs-comment">//处理新的Refresh Token</span>
signin::IdentityManager::GetAccountsMutator()-&gt;AddOrUpdateAccount <span class="hljs-comment">//添加或更新账户</span>
ProcessDiceHeaderDelegateImpl::EnableSync <span class="hljs-comment">//打开同步功能</span>
</code></pre>
<h2 id="-www-google-com-">打开www.google.com获取账户的流程</h2>
<p>在初始化时，会从WebData中获取同步账户的Refresh Token，</p>
<pre><code class="lang-cpp">MutableProfileOAuth2TokenServiceDelegate::OnWebDataServiceRequestDone <span class="hljs-comment">//读取WebData成功的回调</span>
MutableProfileOAuth2TokenServiceDelegate::LoadAllCredentialsIntoMemory <span class="hljs-comment">//加载有Refresh Token的账户到内存</span>
signin::IdentityManager::OnRefreshTokenAvailable <span class="hljs-comment">//分发有效Refresh Token事件</span>
AccountFetcherService::OnRefreshTokenAvailable <span class="hljs-comment">//更新Refresh Token以便于获取Access Token</span>
gcm::AccountTracker::OnRefreshTokenUpdatedForAccount <span class="hljs-comment">//gcm添加账户</span>
</code></pre>
<p>在网络启动后，会调用GaiaCookieManagerService::StartFetchingListAccounts从网络上获取当前用户的列表，
获取成功后会调用IdentityManager::OnGaiaAccountsInCookieUpdated分发Gaia cookie Accounts更新。</p>
<pre><code class="lang-cpp">ChromeSigninClient::OnConnectionChanged <span class="hljs-comment">//网络连接回调</span>
GaiaCookieManagerService::StartFetchingListAccounts <span class="hljs-comment">//启动获取当前用户列表</span>
GaiaAuthFetcher::StartListAccounts <span class="hljs-comment">//访问网络获取用户列表</span>
GaiaCookieManagerService::OnListAccountsSuccess <span class="hljs-comment">//用户列表获取成功</span>
IdentityManager::OnGaiaAccountsInCookieUpdated <span class="hljs-comment">//分发cookie用户通知</span>
<span class="hljs-comment">//http示例</span>
<span class="hljs-comment">//https://accounts.google.com/ListAccounts?gpsia=1&amp;source=ChromiumBrowser&amp;json=standard</span>
<span class="hljs-comment">//cookie: 1P_JAR=2022-08-11-10; SID=NQi7LcU7AY-KG783C2Yx7bXMh_sW06fKfUNC_VGxTIm2hy...</span>
</code></pre>
<p>点登录按键后，a标签打开新页面</p>
<pre><code class="lang-cpp">//https:<span class="hljs-regexp">//accounts</span>.google.com/ServiceLogin?hl=zh-CN&amp;passive=true&amp;<span class="hljs-keyword">continue</span>=https:<span class="hljs-regexp">//www</span>.google.com.hk/&amp;ec=GAZAmgQ
//https:<span class="hljs-regexp">//accounts</span>.google.coAIzaSyB4OXx0GPzBeBR5qolRy4_xBwJUXa5G-b8m.hk/accounts/SetSID?ssdc=<span class="hljs-number">1</span>&amp;sidt=ALWU2ct8EPY%2BzgyMkhsYTw5O%2ByfJHmsBI1x6oV%2FCIv7%2F4V96ODzCqWf5rLNjsVfJ8IDWL7P%2BC5dABLW6QfbXdenRrDTCTCGUHho3hwcyCq7XFRnx8I2xGM4MKehYOAXrCIl1O5DsdC6k61pPzZSE16LW5xN0g%2BU3al1BM%2FpvM8CFGvMtpxgaWVUIJ65Dc%2BUNCx1Sxbf21BH8NtkIAhfsJtY%2FrqL6TpWrlt%2B%2BrFall4nT8gpSIgW00OFYTlsiyj9vTjbTXQP3TV%2F1RcybnoFGy%2BwHuKaHCgb%2B8ixhZtJt2%2BzbWZIQ0hfKYHQ26fC3htIoQXnSD0dXRQeV%2BDugDX7a0J%2FaHX7N0Vx1%2Fe3VquJ81XNBn%2F5vsqCAlRAjdaEd8%2FdSRTxNfU%2FbsbZWsgrfvtY9E1TNjY544rrMAUJ8S%2BY%2BpFsldGqqHuqM4ES6BKn1Z9ByGQpmETWiT2GYwUDUv8nogTIKcaAy1WM5yQ%3D%3D&amp;<span class="hljs-keyword">continue</span>=https%3A%2F%2Fwww.google.com.hk%2F%3Fpli%3D1
</code></pre>
<h2 id="chromium-gaia-">Chromium启动时发起的Gaia请求</h2>
<p>在浏览器初始化网络后，调用GaiaCookieManagerService::InitCookieListener，会在CookieManager中添加url为&quot;<a href="https://google.com/&quot;，">https://google.com/&quot;，</a>
name为&quot;SAPISID&quot;的监听，在网络连接后调用GaiaCookieManagerService::StartFetchingListAccounts发送一个list请求，
从WebData获取到账户的Refresh Token后会调用AccountFetcherService::OnRefreshTokensLoaded来刷新账户信息，
每个账户会调用AccountCapabilitiesFetcherGaia::StartImpl来获取Account Capabilities的Access Token，
这会调用OAuth2AccessTokenManager::StartRequestForClientWithContext先看看有Token缓存不，
然后再调用GaiaAccessTokenFetcher::CreateExchangeRefreshTokenForAccessTokenInstance发起请求。</p>
<pre><code class="lang-cpp">GaiaCookieManagerService::InitCookieListener <span class="hljs-comment">//为google添加Cookie监听器</span>
GaiaCookieManagerService::StartFetchingListAccounts <span class="hljs-comment">//发起list accounts请求</span>
WebDataRequestManager::RequestCompletedOnThread <span class="hljs-comment">//WebData获取成功</span>
MutableProfileOAuth2TokenServiceDelegate::FinishLoadingCredentials <span class="hljs-comment">//获取WebData中的Refresh Token</span>
AccountFetcherService::OnRefreshTokensLoaded <span class="hljs-comment">//Refresh Token加载完成</span>
AccountFetcherService::RefreshAccountInfo <span class="hljs-comment">//刷新账户信息</span>
AccountCapabilitiesFetcherGaia::StartImpl <span class="hljs-comment">//获取账户信息的Access Token</span>
OAuth2AccessTokenManager::StartRequestForClientWithContext <span class="hljs-comment">//如果Cache中没有，那么从网上获取</span>
GaiaAccessTokenFetcher::CreateExchangeRefreshTokenForAccessTokenInstance <span class="hljs-comment">//发起Access Token请求</span>
AccountFetcherService::StartFetchingUserInfo <span class="hljs-comment">//获取用户信息</span>
SyncAuthManager::RequestAccessToken <span class="hljs-comment">//获取同步的Access Token</span>
GCMAccountTracker::GetToken <span class="hljs-comment">//获取GCM的Access Token</span>
GaiaCookieManagerService::ExternalCcResultFetcher::Start <span class="hljs-comment">//获取网络检查信息</span>
</code></pre>
<h2 id="listaccounts-">ListAccounts请求分析</h2>
<p>ListAccounts请求是Chromium比较重要的请求，起到串起登陆的流程的作用。
在Chromium启动时会发出一个ListAccounts请求，其中的Cookie是Chromium关闭前保存的，如上分析。
其次在Cookie的&quot;<a href="https://google.com/&quot;监听器中，只要cookie有变化，删除或添加，那么都会重新发一个ListAccounts请求。">https://google.com/&quot;监听器中，只要cookie有变化，删除或添加，那么都会重新发一个ListAccounts请求。</a>
在获取用户列表成功后，会通知signin::IdentityManager::OnGaiaAccountsInCookieUpdated，
这里会调用AccountReconcilor::StartReconcile来同步OAuth2到Cookie中，
其中会调用到signin::AccountsCookieMutatorImpl::SetAccountsInCookie发起将账户设置到Cookie的逻辑，
逻辑首先调用signin::OAuthMultiloginHelper::StartFetchingTokens开始获取Access Token，
其中会调用ProfileOAuth2TokenService::StartRequestForMultilogin判断是从网络获取，还是直接将Refresh Token做为Access Token，
获取到Access Token后调用signin::OAuthMultiloginHelper::StartFetchingMultiLogin发起登陆请求，
登陆请求返回中会有一些Cookie，通过signin::OAuthMultiloginHelper::StartSettingCookies设置到CookieManager中。</p>
<pre><code class="lang-cpp">GaiaCookieManagerService::OnCookieChange <span class="hljs-comment">//Cookie发生了变化</span>
GaiaCookieManagerService::StartFetchingListAccounts <span class="hljs-comment">//开始ListAccounts请求</span>
GaiaCookieManagerService::OnListAccountsSuccess <span class="hljs-comment">//请求返回成功</span>
signin::IdentityManager::OnGaiaAccountsInCookieUpdated <span class="hljs-comment">//分发账户变化通知</span>
AccountReconcilor::StartReconcile <span class="hljs-comment">//协调OAuth2账户成Cookie账户</span>
signin::AccountsCookieMutatorImpl::SetAccountsInCookie <span class="hljs-comment">//开始设置账户到Cookie中</span>
signin::OAuthMultiloginHelper::StartFetchingTokens <span class="hljs-comment">//首先要获取账户的Access Token</span>
ProfileOAuth2TokenService::StartRequestForMultilogin <span class="hljs-comment">//如果有Refresh Token那么做为Access Token进行下一步</span>
signin::OAuthMultiloginHelper::StartFetchingMultiLogin <span class="hljs-comment">//收到Access Token后发起登陆请求</span>
signin::OAuthMultiloginHelper::StartSettingCookies <span class="hljs-comment">//收到登陆成功返回后将其数据设置到Cookie中</span>
GaiaCookieManagerService::StartFetchingListAccounts <span class="hljs-comment">//Cookie发生变化发起新的ListAccounts请求</span>
</code></pre>
<h2 id="chromeos-chromium-">ChromeOS上Chromium账户管理</h2>
<h3 id="-http-header">自定义Http Header</h3>
<p>在ChromeOS登陆后，每次访问google服务都会带上一个自定义Http Header用于表示当前的登陆账户，名字为X-Chrome-Connected
这样服务可以调用一些Native UI。但是在Chromium中也有一些情况会有这个Http Header，
如在访问“<a href="https://drive.google.com”和“https://docs.google.com”服务时，这是为了开启离线模式。">https://drive.google.com”和“https://docs.google.com”服务时，这是为了开启离线模式。</a></p>
<pre><code class="lang-cpp">x-chrome-connected: source=Chrome,<span class="hljs-built_in">id</span>=<span class="hljs-number">113934407622812037815</span>,mode=<span class="hljs-number">0</span>,enable_account_consistency=<span class="hljs-literal">false</span>,consistency_enabled_by_default=<span class="hljs-literal">false</span>
</code></pre>
<h3 id="lacros">LACROS</h3>
<p>这是从ChromeOS解耦出来的Browser，可以在ChromeOS和Linux上运行，因此Linux And ChRome OS而命名为LACROS。
这样在ChromeOS上有两个版本一个是IS_CHROMEOS_LACROS，一个是IS_CHROMEOS_ASH，
在账户管理方面有细微差别，但是都通过mojo调用了account_manager::AccountManager。</p>
<h3 id="-">启动时获取账户信息</h3>
<p>ChromeOS启动后会提示登陆，登陆成功后会调用ash::OAuth2TokenInitializer::Start获取账户的Refresh Token并保存到AccountManager中，
AccountManager会通知ProfileOAuth2TokenServiceDelegateChromeOS，并更新ash::OAuth2LoginManager,
首先发起ListAccounts请求，请求返回后先通过AccountReconcilor进行账户对帐，同时开始将账户添加到Cookie中，
这样就会发起三个请求，一个是登陆，一个是获取Ubertoken，一个是合并Session。</p>
<pre><code class="lang-cpp">ash::OAuth2TokenInitializer::Start <span class="hljs-comment">//登陆后开始获取Refresh Token</span>
signin::ProfileOAuth2TokenServiceDelegateChromeOS::FinishLoadingCredentials <span class="hljs-comment">//被通知Refresh Tokon有更新</span>
ash::OAuth2LoginManager::OnRefreshTokenUpdatedForAccount <span class="hljs-comment">//开始验证Refresh Token</span>
GaiaCookieManagerService::StartFetchingListAccounts <span class="hljs-comment">//发起ListAccounts请求</span>
AccountReconcilor::OnAccountsInCookieUpdated <span class="hljs-comment">//进行账户的对账</span>
ash::OAuth2LoginManager::OnListAccountsSuccess <span class="hljs-comment">//请求返回后验证当前Token状态</span>
signin::AccountsCookieMutatorImpl::AddAccountToCookieWithToken <span class="hljs-comment">//开始将账户添加到Cookie</span>
account_manager::AccountManagerFacadeImpl::AccessTokenFetcher::OnAccessTokenFetchComplete <span class="hljs-comment">//返回登陆Access Token</span>
signin::OAuthMultiloginHelper::StartFetchingMultiLogin <span class="hljs-comment">//发起登陆请求</span>
GaiaCookieManagerService::StartFetchingUbertoken <span class="hljs-comment">//发起获取Uber Token请求</span>
GaiaCookieManagerService::StartFetchingMergeSession <span class="hljs-comment">//发起合并Session请求</span>
</code></pre>
<p>从上面过程看，ChromeOS和Chromium登陆过程主要有三个差异：</p>
<ul>
<li>获取Refresh Token的地方不同，ChromeOS是在用户管理中发起请求并保存</li>
<li>Chromium通过mojo到ChromeOS获取Access Token</li>
<li>在发起登陆过程中，还发起了添加账户的请求，分成了两步，一个获取Uber Token，一是合并Session</li>
</ul>
<h3 id="chromeos-">ChromeOS启动时网络请求</h3>
<p>ChromeOS启动后先打开WebUI页面，让用户进行语言设置，然后打开邮箱输入页面，因为Profile默认是不记录历史，因此没有自定义的http header：</p>
<pre><code><span class="hljs-string">url：</span>
<span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com/</span><span class="hljs-string">embedded/</span><span class="hljs-string">setup/</span><span class="hljs-string">v2/</span><span class="hljs-string">chromeos?</span><span class="hljs-string">chrometype=</span><span class="hljs-string">chromedevice&amp;</span><span class="hljs-string">client_id=</span><span class="hljs-string">77185425430.</span><span class="hljs-string">apps.</span><span class="hljs-string">googleusercontent.</span><span class="hljs-string">com&amp;</span><span class="hljs-string">client_version=</span><span class="hljs-string">107.</span>0.<span class="hljs-string">5278.</span>0&amp;<span class="hljs-string">platform_version=</span>0.0.0.0&amp;<span class="hljs-string">endpoint_gen=</span>1.0&amp;<span class="hljs-string">mi=</span><span class="hljs-string">ee&amp;</span><span class="hljs-string">is_first_user=</span><span class="hljs-string">true&amp;</span><span class="hljs-string">hl=</span><span class="hljs-string">en-US&amp;</span><span class="hljs-string">use_native_navigation=</span>1

<span class="hljs-string">request </span><span class="hljs-string">header：</span>
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua:</span> <span class="hljs-string">"Chromium"</span>;v=<span class="hljs-string">"107"</span>, <span class="hljs-string">"Not=A?Brand"</span>;v=<span class="hljs-string">"24"</span>
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-mobile:</span> ?0
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-platform:</span> <span class="hljs-string">"Chromium OS"</span>
<span class="hljs-string">upgrade-insecure-</span><span class="hljs-string">requests:</span> 1
<span class="hljs-string">user-agent:</span> <span class="hljs-string">Mozilla/</span>5.0 (<span class="hljs-string">X11;</span> <span class="hljs-string">CrOS </span><span class="hljs-string">x86_64 </span><span class="hljs-string">14541.</span>0.0) <span class="hljs-string">AppleWebKit/</span><span class="hljs-string">537.</span><span class="hljs-string">36 </span>(<span class="hljs-string">KHTML,</span> <span class="hljs-string">like </span><span class="hljs-string">Gecko)</span> <span class="hljs-string">Chrome/</span><span class="hljs-string">107.</span>0.0.0 <span class="hljs-string">Safari/</span><span class="hljs-string">537.</span><span class="hljs-string">36
</span><span class="hljs-string">accept:</span> <span class="hljs-string">text/</span><span class="hljs-string">html,</span><span class="hljs-string">application/</span><span class="hljs-string">xhtml+</span><span class="hljs-string">xml,</span><span class="hljs-string">application/</span><span class="hljs-string">xml;</span>q=0.9,<span class="hljs-string">image/</span><span class="hljs-string">avif,</span><span class="hljs-string">image/</span><span class="hljs-string">webp,</span><span class="hljs-string">image/</span><span class="hljs-string">apng,</span>*/*;q=0.8,<span class="hljs-string">application/</span><span class="hljs-string">signed-exchange;</span>v=<span class="hljs-string">b3;</span>q=0.9
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-full-</span><span class="hljs-string">version:</span> <span class="hljs-string">"107.0.5278.0"</span>
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-arch:</span> <span class="hljs-string">"x86"</span>
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-model:</span> <span class="hljs-string">""</span>
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-bitness:</span> <span class="hljs-string">"64"</span>
<span class="hljs-string">sec-fetch-</span><span class="hljs-string">site:</span> <span class="hljs-string">none
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">mode:</span> <span class="hljs-string">navigate
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">user:</span> ?1
<span class="hljs-string">sec-fetch-</span><span class="hljs-string">dest:</span> <span class="hljs-string">document
</span><span class="hljs-string">accept-encoding:</span> <span class="hljs-string">gzip,</span> <span class="hljs-string">deflate,</span> <span class="hljs-string">br
</span><span class="hljs-string">accept-language:</span> <span class="hljs-string">en-US,</span><span class="hljs-string">en;</span>q=0.9

<span class="hljs-string">respone </span><span class="hljs-string">header：</span>
<span class="hljs-string">HTTP/</span>1.1 <span class="hljs-string">200
</span><span class="hljs-string">content-type:</span> <span class="hljs-string">text/</span><span class="hljs-string">html;</span> <span class="hljs-string">charset=</span><span class="hljs-string">utf-8
</span><span class="hljs-string">x-frame-</span><span class="hljs-string">options:</span> <span class="hljs-string">DENY
</span><span class="hljs-string">vary:</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Dest,</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Mode,</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Site
</span><span class="hljs-string">google-accounts-</span><span class="hljs-string">embedded:</span> 1
<span class="hljs-string">cache-control:</span> <span class="hljs-string">no-cache,</span> <span class="hljs-string">no-store,</span> <span class="hljs-string">max-age=</span>0, <span class="hljs-string">must-revalidate
</span><span class="hljs-string">pragma:</span> <span class="hljs-string">no-cache
</span><span class="hljs-string">expires:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">01 </span><span class="hljs-string">Jan </span><span class="hljs-string">1990 </span><span class="hljs-string">00:00:</span><span class="hljs-string">00 </span><span class="hljs-string">GMT
</span><span class="hljs-string">date:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">05 </span><span class="hljs-string">Sep </span><span class="hljs-string">2022 </span><span class="hljs-string">07:18:</span><span class="hljs-string">03 </span><span class="hljs-string">GMT
</span><span class="hljs-string">content-encoding:</span> <span class="hljs-string">gzip
</span><span class="hljs-string">strict-transport-</span><span class="hljs-string">security:</span> <span class="hljs-string">max-age=</span><span class="hljs-string">31536000;</span> <span class="hljs-string">includeSubDomains
</span><span class="hljs-string">report-to:</span> {<span class="hljs-string">"group"</span>:<span class="hljs-string">"coop_gse_qebhlk"</span>,<span class="hljs-string">"max_age"</span>:<span class="hljs-string">2592000,</span><span class="hljs-string">"endpoints"</span>:[{<span class="hljs-string">"url"</span>:<span class="hljs-string">"https://csp.withgoogle.com/csp/report-to/gse_qebhlk"</span>}]}
<span class="hljs-string">content-security-</span><span class="hljs-string">policy:</span> <span class="hljs-string">script-src </span><span class="hljs-string">'report-sample'</span> <span class="hljs-string">'nonce-Ou2wWlh39pj0wcn0pAy3CQ'</span> <span class="hljs-string">'unsafe-inline'</span> <span class="hljs-string">'unsafe-eval'</span>;<span class="hljs-string">object-src </span><span class="hljs-string">'none'</span>;<span class="hljs-string">base-uri </span><span class="hljs-string">'self'</span>;<span class="hljs-string">report-uri </span>/<span class="hljs-string">cspreport
</span><span class="hljs-string">content-security-</span><span class="hljs-string">policy:</span> <span class="hljs-string">require-trusted-</span><span class="hljs-string">types-for </span><span class="hljs-string">'script'</span>;<span class="hljs-string">report-uri </span>/<span class="hljs-string">cspreport
</span><span class="hljs-string">cross-origin-</span><span class="hljs-string">opener-policy-</span><span class="hljs-string">report-only:</span> <span class="hljs-string">same-origin;</span> <span class="hljs-string">report-to=</span><span class="hljs-string">"coop_gse_qebhlk"</span>
<span class="hljs-string">x-content-</span><span class="hljs-string">type-options:</span> <span class="hljs-string">nosniff
</span><span class="hljs-string">x-xss-</span><span class="hljs-string">protection:</span> 1; <span class="hljs-string">mode=</span><span class="hljs-string">block
</span><span class="hljs-string">server:</span> <span class="hljs-string">GSE
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Host-GAPS=</span><span class="hljs-string">1:QJtsPNVVi9AXmF3hMiBxUbNcKYa7cg:</span><span class="hljs-string">MvCW1tP-XdjZ2Toa;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">03 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">GEM=</span><span class="hljs-string">CgptaW51dGVtYWlkEOfYjeSwMA=</span>=; <span class="hljs-string">Path=</span>/; <span class="hljs-string">Secure;</span> <span class="hljs-string">HttpOnly
</span><span class="hljs-string">alt-svc:</span> <span class="hljs-string">h3=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-29=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q050=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q046=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q043=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">quic=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000;</span> v=<span class="hljs-string">"46,43"</span>
</code></pre><p>在输入账号和密码后会调用登录接口：</p>
<pre><code><span class="hljs-string">url：</span>
<span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com/</span>_/<span class="hljs-string">signin/</span><span class="hljs-string">challenge?</span><span class="hljs-string">hl=</span><span class="hljs-string">en&amp;</span><span class="hljs-string">TL=</span><span class="hljs-string">AKqFyY9K42O9xMvb3WqJeVqq-CmO9lgI6PYcs1dXVt6Bgm3mzhzhNFCqD7T0J3nc&amp;</span><span class="hljs-string">_reqid=</span><span class="hljs-string">155101&amp;</span><span class="hljs-string">rt=</span>j

<span class="hljs-string">request </span><span class="hljs-string">header:</span>
<span class="hljs-string">content-length:</span> <span class="hljs-string">2810
</span><span class="hljs-string">sec-ch-</span><span class="hljs-string">ua:</span> <span class="hljs-string">"Chromium"</span>;v=<span class="hljs-string">"107"</span>, <span class="hljs-string">"Not=A?Brand"</span>;v=<span class="hljs-string">"24"</span>
<span class="hljs-string">x-same-</span><span class="hljs-string">domain:</span> 1
<span class="hljs-string">content-type:</span> <span class="hljs-string">application/</span><span class="hljs-string">x-www-</span><span class="hljs-string">form-urlencoded;</span><span class="hljs-string">charset=</span><span class="hljs-string">UTF-8
</span><span class="hljs-string">google-accounts-</span><span class="hljs-string">xsrf:</span> 1
<span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-mobile:</span> ?0
<span class="hljs-string">user-agent:</span> <span class="hljs-string">Mozilla/</span>5.0 (<span class="hljs-string">X11;</span> <span class="hljs-string">CrOS </span><span class="hljs-string">x86_64 </span><span class="hljs-string">14541.</span>0.0) <span class="hljs-string">AppleWebKit/</span><span class="hljs-string">537.</span><span class="hljs-string">36 </span>(<span class="hljs-string">KHTML,</span> <span class="hljs-string">like </span><span class="hljs-string">Gecko)</span> <span class="hljs-string">Chrome/</span><span class="hljs-string">107.</span>0.0.0 <span class="hljs-string">Safari/</span><span class="hljs-string">537.</span><span class="hljs-string">36
</span><span class="hljs-string">sec-ch-</span><span class="hljs-string">ua-platform:</span> <span class="hljs-string">"Chromium OS"</span>
<span class="hljs-string">accept:</span> */*
<span class="hljs-string">origin:</span> <span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">site:</span> <span class="hljs-string">same-origin
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">mode:</span> <span class="hljs-string">cors
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">dest:</span> <span class="hljs-string">empty
</span><span class="hljs-string">referer:</span> <span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com/</span><span class="hljs-string">signin/</span><span class="hljs-string">v2/</span><span class="hljs-string">challenge/</span><span class="hljs-string">pwd?</span><span class="hljs-string">chrometype=</span><span class="hljs-string">chromedevice&amp;</span><span class="hljs-string">client_id=</span><span class="hljs-string">77185425430.</span><span class="hljs-string">apps.</span><span class="hljs-string">googleusercontent.</span><span class="hljs-string">com&amp;</span><span class="hljs-string">client_version=</span><span class="hljs-string">107.</span>0.<span class="hljs-string">5278.</span>0&amp;<span class="hljs-string">platform_version=</span>0.0.0.0&amp;<span class="hljs-string">endpoint_gen=</span>1.0&amp;<span class="hljs-string">mi=</span><span class="hljs-string">ee&amp;</span><span class="hljs-string">is_first_user=</span><span class="hljs-string">true&amp;</span><span class="hljs-string">hl=</span><span class="hljs-string">en-US&amp;</span><span class="hljs-string">use_native_navigation=</span>1&amp;<span class="hljs-string">flowName=</span><span class="hljs-string">GlifSetupChromeOs&amp;</span><span class="hljs-string">cid=</span>1&amp;<span class="hljs-string">navigationDirection=</span><span class="hljs-string">forward&amp;</span><span class="hljs-string">TL=</span><span class="hljs-string">AKqFyY9K42O9xMvb3WqJeVqq-CmO9lgI6PYcs1dXVt6Bgm3mzhzhNFCqD7T0J3nc
</span><span class="hljs-string">accept-encoding:</span> <span class="hljs-string">gzip,</span> <span class="hljs-string">deflate,</span> <span class="hljs-string">br
</span><span class="hljs-string">accept-language:</span> <span class="hljs-string">en-US,</span><span class="hljs-string">en;</span>q=0.9
<span class="hljs-string">cookie:</span> <span class="hljs-string">GEM=</span><span class="hljs-string">CgptaW51dGVtYWlkEOfYjeSwMA=</span>=; <span class="hljs-string">NID=</span><span class="hljs-string">511=</span><span class="hljs-string">bjL3i-NM-</span><span class="hljs-string">poEuv1lEQFVKOEaj0wK75V9hQ_Cwxvq8ZzLsKB7KUIBV5IeWXu7pSjJaULDfZAyYektdkRPW-TrLWM2FU_-</span><span class="hljs-string">N3UefBCZXo1iWfyVTH9PvVeJeasrBXmtW0bJeHx0tGxkNV-b-</span><span class="hljs-string">PgnIryWmmargvruXiltlcGeNi99ZQ0;</span> <span class="hljs-string">__Host-GAPS=</span><span class="hljs-string">1:MUZAP-</span><span class="hljs-string">0HyWSLWI-VIbCOHIsCIQ39rw:dV9qYfRR61jksjZi
</span>
<span class="hljs-string">respone </span><span class="hljs-string">header:</span>
<span class="hljs-string">HTTP/</span>1.1 <span class="hljs-string">200
</span><span class="hljs-string">content-type:</span> <span class="hljs-string">application/</span><span class="hljs-string">json;</span> <span class="hljs-string">charset=</span><span class="hljs-string">utf-8
</span><span class="hljs-string">x-frame-</span><span class="hljs-string">options:</span> <span class="hljs-string">DENY
</span><span class="hljs-string">vary:</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Dest,</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Mode,</span> <span class="hljs-string">Sec-Fetch-</span><span class="hljs-string">Site
</span><span class="hljs-string">google-accounts-</span><span class="hljs-string">signin:</span> <span class="hljs-string">email=</span><span class="hljs-string">"pwaruntime@gmail.com"</span>, <span class="hljs-string">sessionindex=</span>0, <span class="hljs-string">obfuscatedid=</span><span class="hljs-string">"113934407622812037815"</span>
<span class="hljs-string">cache-control:</span> <span class="hljs-string">no-cache,</span> <span class="hljs-string">no-store,</span> <span class="hljs-string">max-age=</span>0, <span class="hljs-string">must-revalidate
</span><span class="hljs-string">pragma:</span> <span class="hljs-string">no-cache
</span><span class="hljs-string">expires:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">01 </span><span class="hljs-string">Jan </span><span class="hljs-string">1990 </span><span class="hljs-string">00:00:</span><span class="hljs-string">00 </span><span class="hljs-string">GMT
</span><span class="hljs-string">date:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">05 </span><span class="hljs-string">Sep </span><span class="hljs-string">2022 </span><span class="hljs-string">07:18:</span><span class="hljs-string">32 </span><span class="hljs-string">GMT
</span><span class="hljs-string">x-content-</span><span class="hljs-string">type-options:</span> <span class="hljs-string">nosniff
</span><span class="hljs-string">content-encoding:</span> <span class="hljs-string">gzip
</span><span class="hljs-string">strict-transport-</span><span class="hljs-string">security:</span> <span class="hljs-string">max-age=</span><span class="hljs-string">31536000;</span> <span class="hljs-string">includeSubDomains
</span><span class="hljs-string">report-to:</span> {<span class="hljs-string">"group"</span>:<span class="hljs-string">"coop_gse_qebhlk"</span>,<span class="hljs-string">"max_age"</span>:<span class="hljs-string">2592000,</span><span class="hljs-string">"endpoints"</span>:[{<span class="hljs-string">"url"</span>:<span class="hljs-string">"https://csp.withgoogle.com/csp/report-to/gse_qebhlk"</span>}]}
<span class="hljs-string">content-security-</span><span class="hljs-string">policy:</span> <span class="hljs-string">require-trusted-</span><span class="hljs-string">types-for </span><span class="hljs-string">'script'</span>;<span class="hljs-string">report-uri </span>/<span class="hljs-string">cspreport
</span><span class="hljs-string">cross-origin-</span><span class="hljs-string">opener-policy-</span><span class="hljs-string">report-only:</span> <span class="hljs-string">same-origin;</span> <span class="hljs-string">report-to=</span><span class="hljs-string">"coop_gse_qebhlk"</span>
<span class="hljs-string">x-xss-</span><span class="hljs-string">protection:</span> 1; <span class="hljs-string">mode=</span><span class="hljs-string">block
</span><span class="hljs-string">server:</span> <span class="hljs-string">GSE
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Host-GAPS=</span><span class="hljs-string">1:WVjhJYXBMiGLqNccUbH5z9Esw0uU_w:</span><span class="hljs-string">OO43SkCDUeb1x7Gp;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">32 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">oauth_code=</span>4/<span class="hljs-string">0AdQt8qjdiIXiQtvPqxTpoR0yY5FdGjEeW-4Q2Pw_8f93QxkCaJsY8SJDkeHVNJxZDbhzug;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly
</span><span class="hljs-string">alt-svc:</span> <span class="hljs-string">h3=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-29=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q050=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q046=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q043=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">quic=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000;</span> v=<span class="hljs-string">"46,43"</span>
</code></pre><p>其中oauth_code会通过监听cookie的方式获取，获取到oauth_code后，会通过base::GenerateGUID生成device_id，然后换取Refresh Token：</p>
<pre><code>url：
<span class="hljs-string">https:</span><span class="hljs-comment">//www.googleapis.com/oauth2/v4/token</span>

request <span class="hljs-string">header:</span>
content-<span class="hljs-string">type:</span> application/x-www-form-urlencoded
sec-fetch-<span class="hljs-string">site:</span> none
sec-fetch-<span class="hljs-string">mode:</span> no-cors
sec-fetch-<span class="hljs-string">dest:</span> empty
user-<span class="hljs-string">agent:</span> Mozilla<span class="hljs-regexp">/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/</span><span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-regexp">/107.0.0.0 Safari/</span><span class="hljs-number">537.36</span>
accept-<span class="hljs-string">encoding:</span> gzip, deflate, br
<span class="hljs-symbol">
body:</span>
scope=<span class="hljs-string">https:</span><span class="hljs-comment">//www.google.com/accounts/OAuthLogin&amp;grant_type=authorization_code&amp;client_id=77185425430.apps.googleusercontent.com&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;code=4/0AdQt8qi6eX5YI90x_VtJNrB8i</span>

respone <span class="hljs-string">header:</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span>
<span class="hljs-string">expires:</span> Mon, <span class="hljs-number">01</span> Jan <span class="hljs-number">1990</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT
<span class="hljs-string">pragma:</span> no-cache
cache-<span class="hljs-string">control:</span> no-cache, no-store, max-age=<span class="hljs-number">0</span>, must-revalidate
<span class="hljs-string">date:</span> Mon, <span class="hljs-number">05</span> Sep <span class="hljs-number">2022</span> <span class="hljs-number">07</span>:<span class="hljs-number">18</span>:<span class="hljs-number">33</span> GMT
content-<span class="hljs-string">type:</span> application/json; charset=utf<span class="hljs-number">-8</span>
<span class="hljs-string">vary:</span> Origin
<span class="hljs-string">vary:</span> X-Origin
<span class="hljs-string">vary:</span> Referer
content-<span class="hljs-string">encoding:</span> gzip
<span class="hljs-string">server:</span> scaffolding on HTTPServer2
content-<span class="hljs-string">length:</span> <span class="hljs-number">1236</span>
x-xss-<span class="hljs-string">protection:</span> <span class="hljs-number">0</span>
x-frame-<span class="hljs-string">options:</span> SAMEORIGIN
x-content-type-<span class="hljs-string">options:</span> nosniff
alt-<span class="hljs-string">svc:</span> h3=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3<span class="hljs-number">-29</span>=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q050=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q046=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q043=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,quic=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>; v=<span class="hljs-string">"46,43"</span>
<span class="hljs-symbol">
data:</span>
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1u-j8-Ct_gH7XG6rVodF_pRt92sJGcFVH2IChEJsHxzGx7Z7zc0_z0erg_WiXZibV_6sijO7wzQ9B0BhtbeY8XcRCB8KP_Zhwkt6kavuT9ro87oqNvAfgtAICNwJuH44vPG6Dt9uApaq8n5wm88EYOt5SPEw5uwhJD7kwmzOAiCHxmLy8GSMCovG-vyudfSlknc7DaR1RKrWg8R-RLim_hCQy_eXwwizvRfR6h5LJqonlGLsUO-8V2tmNyXUPAaCgYKATASAQASFQE65dr8O0xhGikCM1Un8TP7_zWBQQ0266"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">82189</span>,
  <span class="hljs-string">"refresh_token"</span>: <span class="hljs-string">"1//0ep6aVs1hei7dCgYIARAAGA4SNwF-L9IrjDlmnDV9FLpSnHaZJzZE6zMdgObGx97yTxSkonss_69N4d6RyZB8Ode2THxlKz4FhJo"</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>,
  <span class="hljs-string">"id_token"</span>: <span class="hljs-string">"eyJhbGciOiJSUzI1NiIsImtpZCI6ImU4NDdkOTk0OGU4NTQ1OTQ4ZmE4MTU3YjczZTkxNWM1NjczMDJkNGUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI3NzE4NTQyNTQzMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6Ijc3MTg1NDI1NDMwLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTEzOTM0NDA3NjIyODEyMDM3ODE1IiwiZW1haWwiOiJwd2FydW50aW1lQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiTHVHX2IxRi1DT1RqRkFoY21MM3FEdyIsIm5hbWUiOiJEYW8gRGluZyIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BSXRidm1uNnNyaDlTOTdNcjlCM0dYQ3VTcGdvOE1xNlRnb2EwMUNrX2pVXz1zOTYtYyIsImdpdmVuX25hbWUiOiJEYW8iLCJmYW1pbHlfbmFtZSI6IkRpbmciLCJsb2NhbGUiOiJ6aC1DTiIsInNlcnZpY2VzIjpbXSwiaWF0IjoxNjYyNDM1NzQ1LCJleHAiOjE2NjI0MzkzNDV9.Nq-ls-0nrhW7PiYk3Q4bNZBMXJA2EttKh4dH2KGP6RDVaKIQCNHCt5WxQADofzfLW7hUBjWoUIZ8-aMswjqyu97N0-t22CQRr6o5tSKYquOmaFKD2xrGye7sD04fwrsQGn0doFDnELEJuGU2v2JEXA83TNVTXKQFcSKxdtRQ0rnZCh9QF4YMPh5Wqmcmq73emJGCPyV7NSLZqFNWSWcgwJAbU932BAL3oA--WDWa1nkSkztRVTNy_AGAxSqbX5dH0CEnMfPBFK8uftAIoJlH5CmQWnPrC0ULT9XApq7UZBvA8nSW9xfvdaU4ewvI_JhzI9W_5gzDWHXjwLUXvcwtaQ"</span>
}
</code></pre><p>获取到Refresh Token和Access Token后，会调用login接口：</p>
<pre><code><span class="hljs-string">url:</span>
<span class="hljs-string">https:</span><span class="hljs-comment">//accounts.google.com/oauth/multilogin?source=ChromiumAccountReconcilor&amp;reuseCookies=0</span>

request <span class="hljs-string">header:</span>
content-<span class="hljs-string">length:</span> <span class="hljs-number">1</span>
<span class="hljs-string">authorization:</span> MultiBearer ya29.a0AVA9y1uiv6r13spjA0J7hfFFSSqZEC2OF94WZpEhhiQOZBVnZObBnFoyIqbS6npfC4510pnyMtoQAD5PvxPX23zMaIoZNZRhsS0zqRBPdotk-DlNnj9Hgn4XTMWrBDpDU87jeVNqgzhs9pAYo6RTKPrHK7Lmtj23sVkWoLmhKaqE8g3NzPtWLAc6WHVZPD0SfmC4mFhxfG3R6vUSAAAs8MHhyDsqYCSVxU9-hi1XKU3V2uRlUhf_HW-<span class="hljs-string">CuHYJsSTOWSoaCgYKATASAQASFQE65dr8g7foGT5XAGbIb1sxH8W8Cg0266:</span><span class="hljs-number">113934407622812037815</span>
content-<span class="hljs-string">type:</span> application/x-www-form-urlencoded
sec-fetch-<span class="hljs-string">site:</span> none
sec-fetch-<span class="hljs-string">mode:</span> no-cors
sec-fetch-<span class="hljs-string">dest:</span> empty
user-<span class="hljs-string">agent:</span> Mozilla<span class="hljs-regexp">/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/</span><span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-regexp">/107.0.0.0 Safari/</span><span class="hljs-number">537.36</span>
accept-<span class="hljs-string">encoding:</span> gzip, deflate, br
accept-<span class="hljs-string">language:</span> en-US,en;q=<span class="hljs-number">0.9</span>

respone <span class="hljs-string">header:</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span>
content-<span class="hljs-string">type:</span> application/json; charset=utf<span class="hljs-number">-8</span>
x-frame-<span class="hljs-string">options:</span> DENY
<span class="hljs-string">vary:</span> Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site
x-content-type-<span class="hljs-string">options:</span> nosniff
cache-<span class="hljs-string">control:</span> no-cache, no-store, max-age=<span class="hljs-number">0</span>, must-revalidate
<span class="hljs-string">pragma:</span> no-cache
<span class="hljs-string">expires:</span> Mon, <span class="hljs-number">01</span> Jan <span class="hljs-number">1990</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT
<span class="hljs-string">date:</span> Mon, <span class="hljs-number">05</span> Sep <span class="hljs-number">2022</span> <span class="hljs-number">07</span>:<span class="hljs-number">18</span>:<span class="hljs-number">35</span> GMT
content-<span class="hljs-string">disposition:</span> attachment; filename=<span class="hljs-string">"json.txt"</span>; filename*=UTF<span class="hljs-number">-8</span><span class="hljs-string">''</span>json.txt
content-<span class="hljs-string">encoding:</span> gzip
strict-transport-<span class="hljs-string">security:</span> max-age=<span class="hljs-number">31536000</span>; includeSubDomains
content-security-<span class="hljs-string">policy:</span> require-trusted-types-<span class="hljs-keyword">for</span> <span class="hljs-string">'script'</span>;report-uri /cspreport
content-security-<span class="hljs-string">policy:</span> script-src <span class="hljs-string">'report-sample'</span> <span class="hljs-string">'nonce-FAJz-vE6VSpijeWcsrBd5A'</span> <span class="hljs-string">'unsafe-inline'</span> <span class="hljs-string">'unsafe-eval'</span>;object-src <span class="hljs-string">'none'</span>;base-uri <span class="hljs-string">'self'</span>;report-uri /cspreport
report-<span class="hljs-string">to:</span> {<span class="hljs-string">"group"</span>:<span class="hljs-string">"coop_gse_qebhlk"</span>,<span class="hljs-string">"max_age"</span>:<span class="hljs-number">2592000</span>,<span class="hljs-string">"endpoints"</span>:[{<span class="hljs-string">"url"</span>:<span class="hljs-string">"https://csp.withgoogle.com/csp/report-to/gse_qebhlk"</span>}]}
cross-origin-opener-policy-report-<span class="hljs-string">only:</span> same-origin; report-to=<span class="hljs-string">"coop_gse_qebhlk"</span>
x-xss-<span class="hljs-string">protection:</span> <span class="hljs-number">1</span>; mode=block
<span class="hljs-string">server:</span> GSE
alt-<span class="hljs-string">svc:</span> h3=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3<span class="hljs-number">-29</span>=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q050=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q046=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q043=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,quic=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>; v=<span class="hljs-string">"46,43"</span>
<span class="hljs-symbol">
data:</span>
{<span class="hljs-string">"status"</span>:<span class="hljs-string">"OK"</span>,<span class="hljs-string">"cookies"</span>:[{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1l8_TNTa59_B_zAElhpwgyEA."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-1PSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1l8hw3YrukgcV0LZfXs3ObWw."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameParty"</span>:<span class="hljs-string">"1"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-3PSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1lLiOe4-qH8vWlX8O_PaQ_kA."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameSite"</span>:<span class="hljs-string">"none"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"HSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"A_3K_bnc2MCJWdCS-"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"AnLRnxFehS3uJPj7V"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"APISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"ZA4ZhyLgkgYJMIzw/AVOkv-RYT9HPr6dS3"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-1PAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameParty"</span>:<span class="hljs-string">"1"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-3PAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com.tw"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameSite"</span>:<span class="hljs-string">"none"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1l8_TNTa59_B_zAElhpwgyEA."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-1PSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1l8hw3YrukgcV0LZfXs3ObWw."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameParty"</span>:<span class="hljs-string">"1"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-3PSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"OAiH8PvwOnrCZC9oU1v8CBTptY4QSC0lF4q4up9AczG46M1lLiOe4-qH8vWlX8O_PaQ_kA."</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameSite"</span>:<span class="hljs-string">"none"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"LSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"s.TW:OAiH8JdC4jr-n7xoa9IeL1ucL2akKPvmdEsSsR6uq2qQvGcHnKQFpib3mqBA6syAYlF3hg."</span>,<span class="hljs-string">"host"</span>:<span class="hljs-string">"accounts.google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Host-1PLSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"s.TW:OAiH8JdC4jr-n7xoa9IeL1ucL2akKPvmdEsSsR6uq2qQvGcHcnRUlOpiXkRIwXxWd3287w."</span>,<span class="hljs-string">"host"</span>:<span class="hljs-string">"accounts.google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameParty"</span>:<span class="hljs-string">"1"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Host-3PLSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"s.TW:OAiH8JdC4jr-n7xoa9IeL1ucL2akKPvmdEsSsR6uq2qQvGcHsGEUsZ4JucgRMegCVqKjkA."</span>,<span class="hljs-string">"host"</span>:<span class="hljs-string">"accounts.google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameSite"</span>:<span class="hljs-string">"none"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"HSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"AySgFfFluDbNtvu2O"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SSID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"A3zusR8u0Qs4Z6DMm"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"APISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"ZA4ZhyLgkgYJMIzw/AVOkv-RYT9HPr6dS3"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"SAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-1PAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameParty"</span>:<span class="hljs-string">"1"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Secure-3PAPISID"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"G9x9S2MlIwtH2Xrn/AUnb2V7PiMT0-X1_K"</span>,<span class="hljs-string">"domain"</span>:<span class="hljs-string">".google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>,<span class="hljs-string">"sameSite"</span>:<span class="hljs-string">"none"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"ACCOUNT_CHOOSER"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"AFx_qI7Sx5yu_TsT5ewLee25tmli3PbSZxSi_RLDQmfE2BDFvtplGt7dELrVUtFrRGWU1A2PD4Oql0_QfOkg_7bL4_m14j2hMqx073FJjgEGmmoEjNS0AupXx4q8YRP7Vc7l0Z4KAcdW"</span>,<span class="hljs-string">"host"</span>:<span class="hljs-string">"accounts.google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>},{<span class="hljs-string">"name"</span>:<span class="hljs-string">"__Host-GAPS"</span>,<span class="hljs-string">"value"</span>:<span class="hljs-string">"1:B8yvPEM62YCys_zPcrIPrGyXgsh72PRSNC_F8UEObw4ye5i9-Ge1e8-I2LJsk8lVtRu_87x15HWpo_SaA97pEvxiwiRW6g:Zk06H0KuDeqwd2a_"</span>,<span class="hljs-string">"host"</span>:<span class="hljs-string">"accounts.google.com"</span>,<span class="hljs-string">"path"</span>:<span class="hljs-string">"/"</span>,<span class="hljs-string">"isSecure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"isHttpOnly"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"maxAge"</span>:<span class="hljs-number">63072000</span>,<span class="hljs-string">"priority"</span>:<span class="hljs-string">"HIGH"</span>}],<span class="hljs-string">"accounts"</span>:[{<span class="hljs-string">"type"</span>:<span class="hljs-string">"PERSON_ACCOUNT"</span>,<span class="hljs-string">"display_name"</span>:<span class="hljs-string">"Dao Ding"</span>,<span class="hljs-string">"display_email"</span>:<span class="hljs-string">"pwaruntime@gmail.com"</span>,<span class="hljs-string">"photo_url"</span>:<span class="hljs-string">"https://lh3.googleusercontent.com/-UCG1ush51EY/AAAAAAAAAAI/AAAAAAAAAAA/Pbv7BhdzzqI/s48-c/photo.jpg"</span>,<span class="hljs-string">"selected"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"default_user"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"authuser"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"valid_session"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"obfuscated_id"</span>:<span class="hljs-string">"113934407622812037815"</span>,<span class="hljs-string">"is_verified"</span>:<span class="hljs-literal">true</span>}]}
</code></pre><p>同时会获取一个Uber Token，</p>
<pre><code>url：
<span class="hljs-string">https:</span><span class="hljs-comment">//accounts.google.com/OAuthLogin?source=ChromiumBrowser&amp;issueuberauth=1</span>

request <span class="hljs-string">header:</span>
<span class="hljs-string">authorization:</span> OAuth ya29.a0AVA9y1uW6qeiObanknnEcO93XR_GZZFKT98R_pZumRxdmqAn7Cui99rb0viiKJklot9TKCGNxiEFImeVZSuIA0pw7gxfo1RLXfvvcySCXV7QJCGSUkfQlZDB8lVjybH4QshV-dgeD1UCOoldjUENak-D8LoEcOWw6r23AHVMupz-XnfcvCQuLRPsypgoD<span class="hljs-number">-6</span>iRlU6Dn4rBbSu7tWK-ZBwJaJI1lkIDwZdAqdnOD0cEeo1tExLiJqj4BdcWwx0gPx1Hk4aCgYKATASAQASFQE65dr8spZyuJGSCg1xdx2vblb0ww0266
sec-fetch-<span class="hljs-string">site:</span> none
sec-fetch-<span class="hljs-string">mode:</span> no-cors
sec-fetch-<span class="hljs-string">dest:</span> empty
user-<span class="hljs-string">agent:</span> Mozilla<span class="hljs-regexp">/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/</span><span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome<span class="hljs-regexp">/107.0.0.0 Safari/</span><span class="hljs-number">537.36</span>
accept-<span class="hljs-string">encoding:</span> gzip, deflate, br
accept-<span class="hljs-string">language:</span> en-US,en;q=<span class="hljs-number">0.9</span>


respone <span class="hljs-string">header:</span>
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span>
content-<span class="hljs-string">type:</span> text/plain; charset=utf<span class="hljs-number">-8</span>
<span class="hljs-string">vary:</span> Sec-Fetch-Dest, Sec-Fetch-Mode, Sec-Fetch-Site
google-accounts-programmatic-<span class="hljs-string">authenticated:</span> <span class="hljs-number">113934407622812037815</span>
cache-<span class="hljs-string">control:</span> no-cache, no-store, max-age=<span class="hljs-number">0</span>, must-revalidate
<span class="hljs-string">pragma:</span> no-cache
<span class="hljs-string">expires:</span> Mon, <span class="hljs-number">01</span> Jan <span class="hljs-number">1990</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT
<span class="hljs-string">date:</span> Mon, <span class="hljs-number">05</span> Sep <span class="hljs-number">2022</span> <span class="hljs-number">07</span>:<span class="hljs-number">18</span>:<span class="hljs-number">35</span> GMT
strict-transport-<span class="hljs-string">security:</span> max-age=<span class="hljs-number">31536000</span>; includeSubDomains
permissions-<span class="hljs-string">policy:</span> ch-ua-arch=*, ch-ua-bitness=*, ch-ua-full-version=*, ch-ua-full-version-list=*, ch-ua-model=*, ch-ua-platform=*, ch-ua-platform-version=*
content-security-<span class="hljs-string">policy:</span> script-src <span class="hljs-string">'report-sample'</span> <span class="hljs-string">'nonce-3cR-yvsqf2NQuY34sUm4mA'</span> <span class="hljs-string">'unsafe-inline'</span>;object-src <span class="hljs-string">'none'</span>;base-uri <span class="hljs-string">'self'</span>;report-uri <span class="hljs-regexp">/_/</span>IdentityAuthOAuthLoginHttp/cspreport;worker-src <span class="hljs-string">'self'</span>
content-security-<span class="hljs-string">policy:</span> script-src <span class="hljs-string">'unsafe-inline'</span> <span class="hljs-string">'self'</span> <span class="hljs-string">https:</span><span class="hljs-comment">//apis.google.com https://ssl.gstatic.com https://www.google.com https://www.gstatic.com https://www.google-analytics.com;report-uri /_/IdentityAuthOAuthLoginHttp/cspreport/allowlist</span>
content-security-<span class="hljs-string">policy:</span> require-trusted-types-<span class="hljs-keyword">for</span> <span class="hljs-string">'script'</span>;report-uri <span class="hljs-regexp">/_/</span>IdentityAuthOAuthLoginHttp/cspreport
cross-origin-opener-<span class="hljs-string">policy:</span> same-origin
accept-<span class="hljs-string">ch:</span> Sec-CH-UA-Arch, Sec-CH-UA-Bitness, Sec-CH-UA-Full-Version, Sec-CH-UA-Full-Version-List, Sec-CH-UA-Model, Sec-CH-UA-Platform, Sec-CH-UA-Platform-Version
content-<span class="hljs-string">encoding:</span> gzip
<span class="hljs-string">server:</span> ESF
x-xss-<span class="hljs-string">protection:</span> <span class="hljs-number">0</span>
x-frame-<span class="hljs-string">options:</span> SAMEORIGIN
x-content-type-<span class="hljs-string">options:</span> nosniff
alt-<span class="hljs-string">svc:</span> h3=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3<span class="hljs-number">-29</span>=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q050=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q046=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,h3-Q043=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>,quic=<span class="hljs-string">":443"</span>; ma=<span class="hljs-number">2592000</span>; v=<span class="hljs-string">"46,43"</span>
<span class="hljs-symbol">
data:</span>
APh<span class="hljs-number">-3</span>FzAoqMaF3GArwTO0C2HylO8QjrC4P4oMEfieaT-VkVSb4HkuA1UfpkAdBraRvGhOztYU3GGPkHX7kIadCkHczhGu2Ur9WIvak-gZLdmqkqyFx9n9sUXRVAK5WysifhdObNUNpc2vmPwEhN0WJlbXuE5qb0N5X4aT8B3VkVh2C8EM1OrIUcu-UZw5LtYFUj64KJgPtV885ZA98v4mT3fky1PT9VozcIo3d4jlQsJBKGVmom-rCdJHPBJf9OeBDyAtNUndOFy8tzAzF29F_Oo9vBJtmzAMVifp5IcDbKli<span class="hljs-number">-0</span>_PRIu5nPYlbu--KOmuEhczxvHD9df0e7fY_YgMvAM-hhx-M8wj8nd3dU8v2W6NQbyG9ImsdCWY1sxh_nXWpHdAb3ALxaGJ-yJuUsV2gAuYYAhTMFoViQezv5FN4K9ZOpWRgCPlZHbYx7Wvif5UaQUQ31FV8IE62UppWOCrU1V1L9kBFZ0PUKfNDLOkpVknCLAtrluatfURpqTJhZg0PS33_06rRmsm0USb0hclNThXXJ34GcOitaNpQysRrw1yYipoyhsJvnWXpKBOoz6qV2T-ExuONGzCiLDhAluT7W93jzFQgn11t7b6ysEs0sEb8P9jai5NDfixoESN6w0i1VL2Dx_903amLLRTQrTbDdvy_-vgNwhGA
</code></pre><p>获取到Uber Token后会调用合并接口将状态进行合并：</p>
<pre><code><span class="hljs-string">url：</span>
<span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com/</span><span class="hljs-string">MergeSession?</span><span class="hljs-string">uberauth=</span><span class="hljs-string">APh-3Fz83cJreRHcAjhJfaU_OVWheonAx7sPA0RRHWSQd0xoLx7yBWkccmh5nwmNqqyo-</span><span class="hljs-string">SFBAyBalOS30dpCHh4mPL82P2zJUJfJ5QTNc5HZozE8UC224aKKfWMVECPPctY1wCTsMyvox2-Veisa2FIk-</span><span class="hljs-string">H64kDsu2JM_BJvUSs9hJesb66SYktuz3sThk9BY5KIdVRtylHOkB8f201g49BD4iv4eg9AFlQ8Vpeshslj7Y9zv_r8ViSRmGwoVOjBJPhJoyuY7DJq27MrBrZqX9oaIf6Lv4Y9m3sX5NDl-g-</span><span class="hljs-string">fa_y6xrpX5HsZjO5tlN15zn0AlfPOFTE-T-</span><span class="hljs-string">pMII4zSGIKepzLshKKtCT0oZAagfQ01Ne00M2VJ1NgtzUmXLNH0ICNubch8-xHrZpOl-</span><span class="hljs-string">SPqx-tnszFaywSjTYpjgSOlYXefzaZ-</span><span class="hljs-string">kctDcHx8PWDR9KawUCO97Vf3SEw7DR4dBiECM0SStrrnJaaZg3-fWOKnuRC-</span><span class="hljs-string">ZN_8VBQSGODYXvU4rko4zT9gdnkJsyz-wz6iwnlx2JtL8858OZjZ0o-</span><span class="hljs-string">FpMh2YhUO0KyT25Ygp3UiZaPq6ViZOcZPsf1LPG7jV2D6_kjH5Ex7fuJYWwicAMDYWWG2EyaDb0W_b_88bwP9FLERNeJ7sdnbA7HFtw7QJIW2PmhOtPD3BJBGX0L_KA&amp;</span><span class="hljs-string">continue=</span><span class="hljs-string">http:</span>//<span class="hljs-string">www.</span><span class="hljs-string">google.</span><span class="hljs-string">com&amp;</span><span class="hljs-string">source=</span><span class="hljs-string">ChromiumOAuth2LoginVerifier
</span>
<span class="hljs-string">request </span><span class="hljs-string">header:</span>
<span class="hljs-string">sec-fetch-</span><span class="hljs-string">site:</span> <span class="hljs-string">none
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">mode:</span> <span class="hljs-string">no-cors
</span><span class="hljs-string">sec-fetch-</span><span class="hljs-string">dest:</span> <span class="hljs-string">empty
</span><span class="hljs-string">user-agent:</span> <span class="hljs-string">Mozilla/</span>5.0 (<span class="hljs-string">X11;</span> <span class="hljs-string">CrOS </span><span class="hljs-string">x86_64 </span><span class="hljs-string">14541.</span>0.0) <span class="hljs-string">AppleWebKit/</span><span class="hljs-string">537.</span><span class="hljs-string">36 </span>(<span class="hljs-string">KHTML,</span> <span class="hljs-string">like </span><span class="hljs-string">Gecko)</span> <span class="hljs-string">Chrome/</span><span class="hljs-string">107.</span>0.0.0 <span class="hljs-string">Safari/</span><span class="hljs-string">537.</span><span class="hljs-string">36
</span><span class="hljs-string">accept-encoding:</span> <span class="hljs-string">gzip,</span> <span class="hljs-string">deflate,</span> <span class="hljs-string">br
</span><span class="hljs-string">accept-language:</span> <span class="hljs-string">en-US,</span><span class="hljs-string">en;</span>q=0.9
<span class="hljs-string">cookie:</span> <span class="hljs-string">SID=</span><span class="hljs-string">OAiH8DQzmZxkLqXdX1k_9Wx0UJTmBy0bqubVnm3pjhN2QzNlmabSN4zb9sSh_tQuwIFDCw.</span>; <span class="hljs-string">__Secure-1PSID=</span><span class="hljs-string">OAiH8DQzmZxkLqXdX1k_9Wx0UJTmBy0bqubVnm3pjhN2QzNlS9hvXQRcK9elcsPF625xLA.</span>; <span class="hljs-string">__Secure-3PSID=</span><span class="hljs-string">OAiH8DQzmZxkLqXdX1k_9Wx0UJTmBy0bqubVnm3pjhN2QzNlM28wULfxuXmIVE1NWeyupg.</span>; <span class="hljs-string">LSID=</span>s.<span class="hljs-string">TW:OAiH8J4VvSn4EDjUsqnquNKfA5MCF8DkzvgfzduQEsXUC_uevlWBmlsZb7ecqUa2ueUlFw.</span>; <span class="hljs-string">__Host-1PLSID=</span>s.<span class="hljs-string">TW:OAiH8J4VvSn4EDjUsqnquNKfA5MCF8DkzvgfzduQEsXUC_ueVs-</span><span class="hljs-string">M5o73e32m-PZh01YtCA.</span>; <span class="hljs-string">__Host-3PLSID=</span>s.<span class="hljs-string">TW:OAiH8J4VvSn4EDjUsqnquNKfA5MCF8DkzvgfzduQEsXUC_ue7V4kCVZH80AXqxCAcmkmRw.</span>; <span class="hljs-string">HSID=</span><span class="hljs-string">AbAdoqs0OOhl7YIYm;</span> <span class="hljs-string">SSID=</span><span class="hljs-string">AYojqDxN5MH0ExAJX;</span> <span class="hljs-string">APISID=</span><span class="hljs-string">3_HoGHwe1CEZY7Ko/</span><span class="hljs-string">Aiom175qDVN0W7ldP;</span> <span class="hljs-string">SAPISID=</span><span class="hljs-string">tUXjaER0aoESj39T/</span><span class="hljs-string">AOfzNkF88WzwDzJgH;</span> <span class="hljs-string">__Secure-1PAPISID=</span><span class="hljs-string">tUXjaER0aoESj39T/</span><span class="hljs-string">AOfzNkF88WzwDzJgH;</span> <span class="hljs-string">__Secure-3PAPISID=</span><span class="hljs-string">tUXjaER0aoESj39T/</span><span class="hljs-string">AOfzNkF88WzwDzJgH;</span> <span class="hljs-string">ACCOUNT_CHOOSER=</span><span class="hljs-string">AFx_qI738cAzfs_L64_YlAGdTfvqaNU1yg2iTSgIviJ0OWJIrtfS1-g7Eu9j-</span><span class="hljs-string">mH-VvTCD0U5XU8QTk6u4MZNk3trEYbyiPF0O1bRo9RUR_kTJRayy3rRqYU9NQdhvg3OZdocuvq6z9kH;</span> <span class="hljs-string">__Host-GAPS=</span><span class="hljs-string">1:64Cbajs8e0AILO5Xr46mnWhygDy4zc4WEQYrdOnZTSSgD6PqRJQcFimmO69QfGd1REmxbOu9LUrAXdF3cb66RVI0UPJuPQ:</span><span class="hljs-string">X_QvcJc_qPeih-Er
</span>
<span class="hljs-string">respone </span><span class="hljs-string">header:</span>
<span class="hljs-string">HTTP/</span>1.1 <span class="hljs-string">302
</span><span class="hljs-string">content-type:</span> <span class="hljs-string">text/</span><span class="hljs-string">html;</span> <span class="hljs-string">charset=</span><span class="hljs-string">UTF-8
</span><span class="hljs-string">strict-transport-</span><span class="hljs-string">security:</span> <span class="hljs-string">max-age=</span><span class="hljs-string">31536000;</span> <span class="hljs-string">includeSubDomains
</span><span class="hljs-string">x-frame-</span><span class="hljs-string">options:</span> <span class="hljs-string">DENY
</span><span class="hljs-string">content-security-</span><span class="hljs-string">policy:</span> <span class="hljs-string">script-src </span><span class="hljs-string">'report-sample'</span> <span class="hljs-string">'nonce-_mW6KiNNN84MM3HhbCCEFQ'</span> <span class="hljs-string">'unsafe-inline'</span> <span class="hljs-string">'unsafe-eval'</span>;<span class="hljs-string">object-src </span><span class="hljs-string">'none'</span>;<span class="hljs-string">base-uri </span><span class="hljs-string">'self'</span>;<span class="hljs-string">report-uri </span>/<span class="hljs-string">cspreport
</span><span class="hljs-string">p3p:</span> <span class="hljs-string">CP=</span><span class="hljs-string">"This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657 for more info."</span>
<span class="hljs-string">p3p:</span> <span class="hljs-string">CP=</span><span class="hljs-string">"This is not a P3P policy! See g.co/p3phelp for more info."</span>
<span class="hljs-string">cache-control:</span> <span class="hljs-string">no-cache,</span> <span class="hljs-string">no-store
</span><span class="hljs-string">pragma:</span> <span class="hljs-string">no-cache
</span><span class="hljs-string">expires:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">01-Jan-</span><span class="hljs-string">1990 </span><span class="hljs-string">00:00:</span><span class="hljs-string">00 </span><span class="hljs-string">GMT
</span><span class="hljs-string">google-accounts-</span><span class="hljs-string">signin:</span> <span class="hljs-string">email=</span><span class="hljs-string">"pwaruntime@gmail.com"</span>, <span class="hljs-string">sessionindex=</span>0, <span class="hljs-string">obfuscatedid=</span><span class="hljs-string">"113934407622812037815"</span>
<span class="hljs-string">location:</span> <span class="hljs-string">https:</span>//<span class="hljs-string">accounts.</span><span class="hljs-string">google.</span><span class="hljs-string">com/</span><span class="hljs-string">CheckCookie?</span><span class="hljs-string">continue=</span><span class="hljs-string">https%</span><span class="hljs-string">3A%</span><span class="hljs-string">2F%</span><span class="hljs-string">2Fwww.</span><span class="hljs-string">google.</span><span class="hljs-string">com&amp;</span><span class="hljs-string">chtml=</span><span class="hljs-string">LoginDoneHtml&amp;</span><span class="hljs-string">gidl=</span><span class="hljs-string">EgIIAA
</span><span class="hljs-string">content-encoding:</span> <span class="hljs-string">gzip
</span><span class="hljs-string">date:</span> <span class="hljs-string">Mon,</span> <span class="hljs-string">05 </span><span class="hljs-string">Sep </span><span class="hljs-string">2022 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT
</span><span class="hljs-string">x-content-</span><span class="hljs-string">type-options:</span> <span class="hljs-string">nosniff
</span><span class="hljs-string">x-xss-</span><span class="hljs-string">protection:</span> 1; <span class="hljs-string">mode=</span><span class="hljs-string">block
</span><span class="hljs-string">content-length:</span> <span class="hljs-string">235
</span><span class="hljs-string">server:</span> <span class="hljs-string">GSE
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">SID=</span><span class="hljs-string">OAiH8BJ3rfsB-Hj-</span><span class="hljs-string">6G-5wY6Ie2TzNEvEq2pH8lEvh89kQ8nQR6FfvG9cr9BgHTTCyC70hQ.</span>;<span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-1PSID=</span><span class="hljs-string">OAiH8BJ3rfsB-Hj-</span><span class="hljs-string">6G-5wY6Ie2TzNEvEq2pH8lEvh89kQ8nQlst9imRAMAUvCVkoHpYMvw.</span>;<span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameParty
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-3PSID=</span><span class="hljs-string">OAiH8BJ3rfsB-Hj-</span><span class="hljs-string">6G-5wY6Ie2TzNEvEq2pH8lEvh89kQ8nQEPBoSoKLxaWfYJqyqR1UzQ.</span>;<span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameSite=</span><span class="hljs-string">none
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">LSID=</span>s.<span class="hljs-string">TW:OAiH8L9auyXUWCRdcdWalEXmxTlTImW0abakdI156tjKezAk_ocmhiNbsJtZRdje0tDLnw.</span>;<span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Host-1PLSID=</span>s.<span class="hljs-string">TW:OAiH8L9auyXUWCRdcdWalEXmxTlTImW0abakdI156tjKezAk4wdyro-</span><span class="hljs-string">KlyOUbiUFTSaDog.</span>;<span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameParty
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Host-3PLSID=</span>s.<span class="hljs-string">TW:OAiH8L9auyXUWCRdcdWalEXmxTlTImW0abakdI156tjKezAk3CAOUIXHAPom6Q5aBA-</span><span class="hljs-string">65Q.</span>;<span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameSite=</span><span class="hljs-string">none
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">HSID=</span><span class="hljs-string">A3ntIJW_sru8YS-jm;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">SSID=</span><span class="hljs-string">A1AX6jQ4wCyuN3upc;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">APISID=</span><span class="hljs-string">4Kl7g1DIP-RRqIji/</span><span class="hljs-string">Abe-SHHToZ0Z63Jnc;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">SAPISID=</span><span class="hljs-string">lUSB4Dyf9Xe7HjcP/</span><span class="hljs-string">ApRW2vFt3iedliIS5;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-1PAPISID=</span><span class="hljs-string">lUSB4Dyf9Xe7HjcP/</span><span class="hljs-string">ApRW2vFt3iedliIS5;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameParty
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-3PAPISID=</span><span class="hljs-string">lUSB4Dyf9Xe7HjcP/</span><span class="hljs-string">ApRW2vFt3iedliIS5;</span><span class="hljs-string">Domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH;</span><span class="hljs-string">SameSite=</span><span class="hljs-string">none
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Host-GAPS=</span><span class="hljs-string">1:h_MvBwD5WuTYeNsPaHxja5BXOJO5cSHNXy7bXmQ3aMeS4ZyziHIU9gh1XFqsStUzsnc03xLfhyMs-</span><span class="hljs-string">TA75A2hocT2D79PwQ:l5FCuvH_XH-</span><span class="hljs-string">icQB_;</span><span class="hljs-string">Path=</span>/;<span class="hljs-string">Expires=</span><span class="hljs-string">Wed,</span> <span class="hljs-string">04-Sep-</span><span class="hljs-string">2024 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span><span class="hljs-string">Secure;</span><span class="hljs-string">HttpOnly;</span><span class="hljs-string">Priority=</span><span class="hljs-string">HIGH
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">NID=</span><span class="hljs-string">511=</span><span class="hljs-string">UM_n9ECvxtjjGj5EWtVK-LvAFIk36h8JlEuamgrF3sztNAAhJV4V3e0fCmfe7ovQthxX1sHRTlkKQftHCGFuJwjxwV73OCjU2rgC4saQ9jVCRQftQut5YafDPiOiRuG59GeGwXIKY7z8Y7AcildAeHJEh19y49MOv_IhDKuycRk34-</span><span class="hljs-string">RWSWqXjKnoIj0Nz_o;</span> <span class="hljs-string">expires=</span><span class="hljs-string">Tue,</span> <span class="hljs-string">07-Mar-</span><span class="hljs-string">2023 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span> <span class="hljs-string">path=</span>/; <span class="hljs-string">domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span> <span class="hljs-string">Secure;</span> <span class="hljs-string">HttpOnly;</span> <span class="hljs-string">SameSite=</span><span class="hljs-string">none
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">SIDCC=</span><span class="hljs-string">AEf-XMRgE6e6ALOtT7VKV4CTCcFP_l_QZXv4Or-</span><span class="hljs-string">pKA5OFN6655ma0YXEzaujj0BFNw6Effq11A;</span> <span class="hljs-string">expires=</span><span class="hljs-string">Tue,</span> <span class="hljs-string">05-Sep-</span><span class="hljs-string">2023 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span> <span class="hljs-string">path=</span>/; <span class="hljs-string">domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span> <span class="hljs-string">priority=</span><span class="hljs-string">high
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-1PSIDCC=</span><span class="hljs-string">AEf-XMSy_YML-</span><span class="hljs-string">IKAMGGLrFm0z8RVab9GMn9cYbCGscn_bQulEX7aNQGXX4YJhQ4aHfINDtib4w;</span> <span class="hljs-string">expires=</span><span class="hljs-string">Tue,</span> <span class="hljs-string">05-Sep-</span><span class="hljs-string">2023 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span> <span class="hljs-string">path=</span>/; <span class="hljs-string">domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span> <span class="hljs-string">Secure;</span> <span class="hljs-string">HttpOnly;</span> <span class="hljs-string">priority=</span><span class="hljs-string">high
</span><span class="hljs-built_in">set-cookie:</span> <span class="hljs-string">__Secure-3PSIDCC=</span><span class="hljs-string">AEf-XMR6qOlFF5GgevuYzqUtz-</span><span class="hljs-string">dcyA7GStVxY6WcDAdxNO-54KfAlJyMv9NXH6LpD487i0Qt;</span> <span class="hljs-string">expires=</span><span class="hljs-string">Tue,</span> <span class="hljs-string">05-Sep-</span><span class="hljs-string">2023 </span><span class="hljs-string">07:18:</span><span class="hljs-string">35 </span><span class="hljs-string">GMT;</span> <span class="hljs-string">path=</span>/; <span class="hljs-string">domain=</span>.<span class="hljs-string">google.</span><span class="hljs-string">com;</span> <span class="hljs-string">Secure;</span> <span class="hljs-string">HttpOnly;</span> <span class="hljs-string">priority=</span><span class="hljs-string">high;</span> <span class="hljs-string">SameSite=</span><span class="hljs-string">none
</span><span class="hljs-string">alt-svc:</span> <span class="hljs-string">h3=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-29=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q050=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q046=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">h3-Q043=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000,</span><span class="hljs-string">quic=</span><span class="hljs-string">":443"</span>; <span class="hljs-string">ma=</span><span class="hljs-string">2592000;</span> v=<span class="hljs-string">"46,43"</span>

<span class="hljs-string">data:</span>
&lt;<span class="hljs-string">html&gt;</span>&lt;<span class="hljs-string">head&gt;</span>&lt;<span class="hljs-string">title&gt;</span>重新定向&lt;/<span class="hljs-string">title&gt;</span>

&lt;<span class="hljs-string">script </span><span class="hljs-string">type=</span><span class="hljs-string">"text/javascript"</span> <span class="hljs-string">language=</span><span class="hljs-string">"javascript"</span> <span class="hljs-string">nonce=</span><span class="hljs-string">"iMGbHyglEI1yY6SdKbhjqQ"</span>&gt;
      // <span class="hljs-string">Accessing </span><span class="hljs-string">window.</span><span class="hljs-string">external </span><span class="hljs-string">members </span><span class="hljs-string">can </span><span class="hljs-string">cause </span><span class="hljs-string">IE </span><span class="hljs-string">to </span><span class="hljs-string">throw </span><span class="hljs-string">exceptions.</span>
      // <span class="hljs-string">Any </span><span class="hljs-string">code </span><span class="hljs-string">that </span><span class="hljs-string">acesses </span><span class="hljs-string">window.</span><span class="hljs-string">external </span><span class="hljs-string">members </span><span class="hljs-string">must </span><span class="hljs-string">be </span><span class="hljs-string">try/</span><span class="hljs-string">catch </span><span class="hljs-string">wrapped
</span>
      <span class="hljs-string">try </span>{
        <span class="hljs-string">if </span>(<span class="hljs-string">top </span>== <span class="hljs-string">self)</span> {
          <span class="hljs-string">if </span>(<span class="hljs-string">window.</span><span class="hljs-string">gtbExternal)</span> {
            <span class="hljs-string">window.</span><span class="hljs-string">gtbExternal.</span><span class="hljs-string">setM(</span>);
          } <span class="hljs-string">else </span>{
            <span class="hljs-string">window.</span><span class="hljs-string">external.</span><span class="hljs-string">setM(</span>);
          }
        }
      }
      <span class="hljs-string">catch(</span><span class="hljs-string">err)</span> {
      }
    &lt;/<span class="hljs-string">script&gt;</span>
&lt;<span class="hljs-string">script </span><span class="hljs-string">type=</span><span class="hljs-string">"text/javascript"</span> <span class="hljs-string">language=</span><span class="hljs-string">"javascript"</span> <span class="hljs-string">nonce=</span><span class="hljs-string">"iMGbHyglEI1yY6SdKbhjqQ"</span>&gt;
      // <span class="hljs-string">If </span><span class="hljs-string">the </span><span class="hljs-string">HTML5 </span><span class="hljs-string">History </span><span class="hljs-string">API </span><span class="hljs-string">is </span><span class="hljs-string">available,</span> <span class="hljs-string">and </span><span class="hljs-string">we </span><span class="hljs-string">don'</span>t <span class="hljs-string">want </span><span class="hljs-string">some </span><span class="hljs-string">tokens </span><span class="hljs-string">in
</span>      // <span class="hljs-string">the </span><span class="hljs-string">current </span><span class="hljs-string">url </span><span class="hljs-string">to </span><span class="hljs-string">be </span><span class="hljs-string">leaked </span><span class="hljs-string">into </span><span class="hljs-string">the </span><span class="hljs-string">Referer,</span> <span class="hljs-string">update </span><span class="hljs-string">the </span><span class="hljs-string">current
</span>      // <span class="hljs-string">history </span><span class="hljs-string">entry.</span>
      <span class="hljs-string">if </span>(!!(<span class="hljs-string">window.</span><span class="hljs-string">history </span>&amp;&amp; <span class="hljs-string">window.</span><span class="hljs-string">history.</span><span class="hljs-string">replaceState)</span>) {

        <span class="hljs-string">try </span>{
          <span class="hljs-string">window.</span><span class="hljs-string">history.</span><span class="hljs-string">replaceState(</span><span class="hljs-string">null,</span> <span class="hljs-string">document.</span><span class="hljs-string">title,</span>
              <span class="hljs-string">"https://accounts.google.com/MergeSession"</span>);
        } <span class="hljs-string">catch </span>(e) {
        }
      }
    &lt;/<span class="hljs-string">script&gt;</span>
&lt;<span class="hljs-string">meta </span><span class="hljs-string">http-equiv=</span><span class="hljs-string">"refresh"</span> <span class="hljs-string">content=</span><span class="hljs-string">"0; url=&amp;#39;http://www.google.com&amp;#39;"</span>&gt;&lt;/<span class="hljs-string">head&gt;</span>
&lt;<span class="hljs-string">body </span><span class="hljs-string">bgcolor=</span><span class="hljs-string">"#ffffff"</span> <span class="hljs-string">text=</span><span class="hljs-string">"#000000"</span> <span class="hljs-string">link=</span><span class="hljs-string">"#0000cc"</span> <span class="hljs-string">vlink=</span><span class="hljs-string">"#551a8b"</span> <span class="hljs-string">alink=</span><span class="hljs-string">"#ff0000"</span>&gt;&lt;<span class="hljs-string">script </span><span class="hljs-string">type=</span><span class="hljs-string">"text/javascript"</span> <span class="hljs-string">language=</span><span class="hljs-string">"javascript"</span> <span class="hljs-string">nonce=</span><span class="hljs-string">"iMGbHyglEI1yY6SdKbhjqQ"</span>&gt;
    <span class="hljs-string">location.</span><span class="hljs-string">replace(</span><span class="hljs-string">"http://www.google.com"</span>)
  &lt;/<span class="hljs-string">script&gt;</span>&lt;/<span class="hljs-string">body&gt;</span>&lt;/<span class="hljs-string">html&gt;</span>
</code></pre><p>这样账户在ChromeOS上登录成功，整个过程有两个登录，一个是browser正常的multilogin，一个是OS通知browser的UberToken，因此在最后有个MergeSession的请求。</p>
<h4 id="-x20-access-toke">&#x20;登录后会获取的Access Toke</h4>
<pre><code>scopes:
https:<span class="hljs-comment">//www.googleapis.com/auth/chromesync</span>

body：
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0eqpjG0Mpv5QLCgYIARAAGA4SNwF-L9Ir5fp58cX8nYb3E0yUkc4vXEt5u1Rnmx47eCk2TkJdgYyGSzgy4kspsnguj8G6WNcPjkU&amp;scope=https://www.googleapis.com/auth/chromesync</span>

respone <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1vCDZdQ2_RovHSk5lQ7h54X6PNbvzBMMyTDCFcX3OGQWbtMZdykmK8DJjzYlH0c-y31ykqppEHxcvuqFdBvIbBfqx61IyLl56-8ExjR0WsbDyB7jamZU46EuqcU4jbB43SQICh9wkjxgQIEiE9OHmRISWzVC6h5x71B2f2A4tshJiw0owFizBy2rfHJBHCFqO6BLiKN_HQEkMTOBn_ZSoGpXlfuuNw3X8HbUP5s7jzjlsRZLSFxJp4qhAaimjXqES0aCgYKATASAQASFQE65dr8zr1aaOvMVJTEkJmvkZcEog0270"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">73374</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>
}



scopes:
https:<span class="hljs-comment">//www.googleapis.com/auth/account.capabilities</span>

<span class="hljs-selector-tag">body</span>:
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0eqpjG0Mpv5QLCgYIARAAGA4SNwF-L9Ir5fp58cX8nYb3E0yUkc4vXEt5u1Rnmx47eCk2TkJdgYyGSzgy4kspsnguj8G6WNcPjkU&amp;scope=https://www.googleapis.com/auth/account.capabilities</span>

response <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1tRedaGzjVUVO3e34_QsuYFAnXZGi6Yd1ckeC36thAWIWP2YG3vg2gIuRyUa-MlMw3QmS9prTZ8kBJyvSHR45I1VvtCDKEz8WAXxZsgIOHjQTwf1un1UB0AkBtBCDaVSKbR72TRIli6-0ERR8_qN69Z6JU7akekmA-burxFc4QGokwv0wuPiEUx78OGsLbkkpR3ciLsjec8n8ayFyUcZn4MQvzpIOap-OiE_V_mzK6TivMQeuxOtyjgeyGGfAaCgYKATASAQASFQE65dr8x30Z6LS4p0PiYJvezBQ0Zg0265"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3599</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>
}
</code></pre><blockquote>
<pre><code>scope<span class="hljs-variable">s:</span>
http<span class="hljs-variable">s:</span>//www.googleapis.<span class="hljs-keyword">com</span>/auth/userinfo.email
http<span class="hljs-variable">s:</span>//www.googleapis.<span class="hljs-keyword">com</span>/auth/userinfo.<span class="hljs-keyword">profile</span>

body:
client_id=<span class="hljs-number">77185425430</span>.apps.googleusercontent.<span class="hljs-keyword">com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span>//<span class="hljs-number">0</span>eqpjG0Mpv5QLCgYIARAAGA4SNwF-L9Ir5fp58cX8nYb3E0yUkc4vXEt5u1Rnmx47eCk2TkJdgYyGSzgy4kspsnguj8G6WNcPjkU&amp;scope=http<span class="hljs-variable">s:</span>//www.googleapis.<span class="hljs-keyword">com</span>/auth/userinfo.email+http<span class="hljs-variable">s:</span>//www.googleapis.<span class="hljs-keyword">com</span>/auth/userinfo.<span class="hljs-keyword">profile</span>

respone body:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1twXi3NPjW3sFu2xpwEEFZjx-KrvzyZ-dVxqotvRPsF8lyftu6qh4-IdFggy2Dd6RHuw9ZpemB-g29vaUve-hpSw83nq0-iux5NCzTcFGqq4IYr4uaJDq09siDOgBhRhtw7F6489yPKqXyuEwICNq5g5oUhg-7Klhmr4V4HuZ2_yOu-mzn16x8IZWPpyg64z8pC6K_8pw5U46pBEV2BaL3zj1V_juKm_XHgAcQphi4lxku_FJ15BVPseqkozwaCgYKATASAQASFQE65dr85_qHpHXXp2kNr0YMj-YXCw0265"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3599</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>,
  <span class="hljs-string">"id_token"</span>: <span class="hljs-string">"eyJhbGciOiJSUzI1NiIsImtpZCI6ImU4NDdkOTk0OGU4NTQ1OTQ4ZmE4MTU3YjczZTkxNWM1NjczMDJkNGUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI3NzE4NTQyNTQzMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6Ijc3MTg1NDI1NDMwLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTEzOTM0NDA3NjIyODEyMDM3ODE1IiwiZW1haWwiOiJwd2FydW50aW1lQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoidVB5VnZ2VkhfYjZiVDlWa29yb3FNZyIsIm5hbWUiOiJEYW8gRGluZyIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BSXRidm1uNnNyaDlTOTdNcjlCM0dYQ3VTcGdvOE1xNlRnb2EwMUNrX2pVXz1zOTYtYyIsImdpdmVuX25hbWUiOiJEYW8iLCJmYW1pbHlfbmFtZSI6IkRpbmciLCJsb2NhbGUiOiJ6aC1DTiIsImlhdCI6MTY2MjQ1MTUyMSwiZXhwIjoxNjYyNDU1MTIxfQ.i3mV3jHto5DhUy8BhVQPYmi1hTFVtPd1yidRXFzmPpugP03Nc8yYtHVrCaizwXBfzfcNpKy17df-YR8H10WtCplicqzfuej1eS1A-wCfREpwXQRkzZ8timSD2nGUPYgdSvGtYg36CcOQ6_4UKXKs3aK1nAxD0pEnkXhhyGcWcSvxj9rqhLaE0-QvHerH9_IqTKNCfkN54GN4cV6OPkDLKAcV4QnwNJ4ttnGNWevDdU7uWETLJNCxX0jmVN3xGievP0-5vnEtW4J474qgFcTDEatWYp8bKiztidiuYssPmiIJCxQobTZZaPUNJb5YxiDNRQjixOiGD_4LK9QxDrbRRw"</span>
}
</code></pre></blockquote>
<pre><code>scopes:
https:<span class="hljs-comment">//www.googleapis.com/auth/cryptauth</span>

<span class="hljs-selector-tag">body</span>:
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0eqpjG0Mpv5QLCgYIARAAGA4SNwF-L9Ir5fp58cX8nYb3E0yUkc4vXEt5u1Rnmx47eCk2TkJdgYyGSzgy4kspsnguj8G6WNcPjkU&amp;scope=https://www.googleapis.com/auth/cryptauth</span>

response <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1sxmYsJ7elwemEuSBK0ITQ2ChcgXsSaDG9ErA3Trs9IaPBHDrGnL3gE6kBvLnfXbL2nXLKHCxA_84jb1T74HXgGOQx4WnSS8V4vhlcxeAtvnmqow7yiAclJzvGdU5PzaqkzojqGPJENa2Q1oLIxJohKfX_R790CHvL2HcV5p04E5v5RZ5l19_-GTcs-Wo6GwMgslzo6NQHgabygAnWY4pM_rQLaniBa45cEEsfnswPbnnYmNhsW6hYC0UugkAaCgYKATASAQASFQE65dr8U2G1t_lj8oYm7aL5HZxfrg0265"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3599</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>
}



scopes:
https:<span class="hljs-comment">//www.googleapis.com/auth/assistant-sdk-prototype</span>
https:<span class="hljs-comment">//www.googleapis.com/auth/gcm</span>

<span class="hljs-selector-tag">body</span>:
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0ek7-Ps_SwU9oCgYIARAAGA4SNwF-L9IrfU2o-yvnpAunXqnrSQeyh1vjxKwqrsKut_nJ6rOa9N2aDisySuzZ3n9yIes-C_LFTP8&amp;scope=https://www.googleapis.com/auth/assistant-sdk-prototype+https://www.googleapis.com/auth/gcm</span>

respones <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1tAC3F6_Qh5mchWQQPOQjFFIzrWuN1k5bJ6X_H7hJoHcVupQzzt72wudquiT1NRZiDiRfY7bIg_ObYeNayNrpydINQnZc3-x5cR06QNyxsJ1W4_B7UUlvXbq35iHuov_OH8rIQrDlEvu9-RbPO_hNS5CuZA8OomE-AB5YMQwX0hoeQPa5Ar0tFYrK_yH8NAvUZiTnw9k0aQW24kWwwzamtaoIKqZIFCIG5IrrCC5ZREfpOUMwSPRr_tZ3V5UhkaCgYKATASAQASFQE65dr8d4ORJdi5n9TkGe49B3iKKA0266"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3599</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>
}



scopes:
https:<span class="hljs-comment">//www.googleapis.com/auth/android_checkin</span>
https:<span class="hljs-comment">//www.googleapis.com/auth/gcm</span>

<span class="hljs-selector-tag">body</span>:
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0ek7-Ps_SwU9oCgYIARAAGA4SNwF-L9IrfU2o-yvnpAunXqnrSQeyh1vjxKwqrsKut_nJ6rOa9N2aDisySuzZ3n9yIes-C_LFTP8&amp;scope=https://www.googleapis.com/auth/android_checkin+https://www.googleapis.com/auth/gcm</span>

response <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1uuT5ZsbE6RCeovW8zRaam7jJgpGgb0huKDuHbrLYYLVGGONPbUo54MzjR2c2z5Vp6EKz7Xos4GOWMk0yBDdAk3emNKz9ef9yMBvi0fAHH8urDC9SbJQQDz-Wb_0yG5-mnO_aBVNOgd0nAPW2XQTYT-Wc-YzaeafVdEOjX8y_Wr1_w1OaG4NiKoRmQWPp1v0FTOu0hN3pECEHccNPbZRTCk4zH5zxNXqMIL8skFgAssWJGMf8rrDmIyRlAhXfAaCgYKATASAQASFQE65dr8PbXHXkB0qgpQWSV2iMwiqQ0266"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3599</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>
}



scopes:
https:<span class="hljs-comment">//www.google.com/accounts/OAuthLogin</span>

<span class="hljs-selector-tag">body</span>:
client_id=<span class="hljs-number">77185425430</span><span class="hljs-selector-class">.apps</span><span class="hljs-selector-class">.googleusercontent</span><span class="hljs-selector-class">.com</span>&amp;client_secret=OTJgUOQcT7lO7GsGZq2G4IlT&amp;grant_type=refresh_token&amp;refresh_token=<span class="hljs-number">1</span><span class="hljs-comment">//0ek7-Ps_SwU9oCgYIARAAGA4SNwF-L9IrfU2o-yvnpAunXqnrSQeyh1vjxKwqrsKut_nJ6rOa9N2aDisySuzZ3n9yIes-C_LFTP8&amp;scope=https://www.google.com/accounts/OAuthLogin</span>

respons <span class="hljs-selector-tag">body</span>:
{
  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"ya29.a0AVA9y1tLVamddlYmMFm-LWMpAFWAG33qy2sv80GR83m2Nnxb10KuY5_M6k15MNqi5r8J-PrE09hwyX297tIhUMojvIwedQ9nc6lGTN_gzJknQ9ZhVNtfLHZzizvTEhSC7OyAcvmrIRXb387_kfb3475DVEpXZR1Eua-qowSHBXP_mEXfB20LKnnEtvKWmgwLFhu9uHr04cYwRL8xnXklWV9LZIoNcEzoiry63W48ITfMFvLcHhtMbUYpRFebTD7xHlMaCgYKATASAQASFQE65dr8TXOZcP9CIWhz3fAT8abeew0266"</span>,
  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">64928</span>,
  <span class="hljs-string">"scope"</span>: <span class="hljs-string">"https://www.google.com/accounts/OAuthLogin"</span>,
  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span>,
  <span class="hljs-string">"id_token"</span>: <span class="hljs-string">"eyJhbGciOiJSUzI1NiIsImtpZCI6ImU4NDdkOTk0OGU4NTQ1OTQ4ZmE4MTU3YjczZTkxNWM1NjczMDJkNGUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI3NzE4NTQyNTQzMC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsImF1ZCI6Ijc3MTg1NDI1NDMwLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTEzOTM0NDA3NjIyODEyMDM3ODE1IiwiZW1haWwiOiJwd2FydW50aW1lQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiRURNcXAyWFJRbjh3c2ZUcmNSaDhCdyIsInNlcnZpY2VzIjpbXSwiaWF0IjoxNjYyNDUyMjM0LCJleHAiOjE2NjI0NTU4MzR9.QYzDj5y8uZUzADOkwmH7VnX-XBKJEtIlKpO3HrfObnqy-fZIUf9S9in0SFqU0pP1CPmTIuQ2GnlVJrTeoyjNStbh2x1eHhkcOh5UNgAVVlRJJQil98PaTZ-DJPoXgSYyLF4DqMFc20NiwQUVvnMZQDc_xs6gHjGKN_oZJxkf8-xWswKwsemW32Hv6QQHEjaWWATNvbb_9xirsLCBLrAm1uUsKzmyo7bMS3KaTLYAOOEKtZ-hg-9HW63I-r7Pe_UYYPn5quDrmhLvBPNpZtHfhCPW0Vn4JWi5lg1cI3vWIGQdtlIXr7q3jnvBy3M8ZK8V0AgwxXrM87J7oD1909t54w"</span>
}
</code></pre><p>scope为https\://www.google.com/accounts/OAuthLogin的Access Token是请求MultiLogin时需要的。</p>
<h4 id="-x20-uber-token-">&#x20;Uber Token的使用</h4>
<p>ChromeOS登录后会通过auth code获取Refresh Token和Access Token，然后获取user info并保存到用户上下文中，当chromium打开登录时，首先通过已经登录的账户中获取Access Token，然后调用MultiLogin请求进行登录，同时ChromeOS也会主动将同一账户添加到chromium中，这个添加行为会调用获取Uber Token请求，然后调用MergeSession请求。整个过程相当于将ChromeOS的账户与Chromium的账户进行合并。</p>

</body>
</html>

